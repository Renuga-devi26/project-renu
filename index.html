<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>RuralCare AI - Complete Patient Portal with Disease Library</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #0d9488;
            --primary-dark: #0f766e;
            --secondary: #eab308;
            --danger: #dc2626;
            --success: #16a34a;
            --info: #0891b2;
            --warning: #f97316;
            --background: #f0fdfa;
            --text: #1e293b;
            --gray: #64748b;
            --light: #f8fafc;
            --border: #e2e8f0;
        }

        body {
            background: var(--background);
            color: var(--text);
            line-height: 1.5;
            padding: 12px;
            max-width: 100%;
            margin: 0 auto;
            font-size: 16px;
            min-height: 100vh;
        }

        /* Login Page Styles */
        .login-container {
            width: 100%;
            max-width: 400px;
            background: white;
            border-radius: 24px;
            padding: 30px 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            margin: 20px auto;
        }

        .login-logo {
            font-size: 3.5rem;
            margin-bottom: 10px;
        }

        .login-title {
            color: var(--primary);
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .login-subtitle {
            color: var(--gray);
            margin-bottom: 30px;
            font-size: 0.95rem;
        }

        .login-form {
            text-align: left;
        }

        .login-input-group {
            margin-bottom: 20px;
        }

        .login-input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text);
            font-size: 0.9rem;
        }

        .login-input-group input {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .login-input-group input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin: 20px 0 15px;
            transition: all 0.3s;
        }

        .login-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .demo-credentials {
            background: var(--light);
            padding: 15px;
            border-radius: 12px;
            font-size: 0.85rem;
            color: var(--gray);
            border: 1px dashed var(--primary);
        }

        .demo-credentials p {
            margin: 5px 0;
        }

        /* Main App Container */
        #mainApp {
            display: none;
            width: 100%;
            max-width: 100%;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 8px 15px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: white;
            color: var(--primary);
        }

        /* Language Switcher */
        .language-bar {
            background: white;
            padding: 10px;
            border-radius: 50px;
            margin-bottom: 15px;
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .lang-btn {
            padding: 6px 12px;
            border: 2px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
            flex: 0 1 auto;
        }

        .lang-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 15px 0;
        }

        .stat-card {
            background: white;
            padding: 12px 5px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-left: 3px solid var(--primary);
        }

        .stat-card .number {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary);
            display: block;
        }

        .stat-card .label {
            font-size: 0.7rem;
            color: var(--gray);
        }

        /* Section Headers */
        .section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 20px 0 12px;
        }

        .section-header h2 {
            color: var(--primary);
            font-size: 1.4rem;
        }

        .section-header .icon {
            font-size: 1.6rem;
        }

        /* Form Section */
        .form-section {
            background: white;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--gray);
            font-size: 0.85rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 0.95rem;
            transition: all 0.3s;
            width: 100%;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Symptom Checker */
        .symptom-checker {
            background: white;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .symptom-categories {
            display: flex;
            gap: 6px;
            margin: 15px 0;
            flex-wrap: wrap;
            max-height: 120px;
            overflow-y: auto;
            padding: 5px;
        }

        .category-btn {
            padding: 6px 10px;
            border: 2px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.8rem;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .category-btn.active {
            background: var(--primary);
            color: white;
        }

        .symptoms-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin: 15px 0;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: var(--light);
            border-radius: 12px;
        }

        .symptom-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            font-size: 0.9rem;
        }

        .symptom-item.selected {
            background: var(--primary);
            color: white;
        }

        .symptom-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }

        .selected-symptoms {
            background: var(--light);
            padding: 12px;
            border-radius: 12px;
            margin: 15px 0;
        }

        .selected-symptoms h3 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .symptom-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .symptom-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 5px 10px;
            background: var(--primary);
            color: white;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .symptom-tag button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
        }

        /* Voice Recording Section */
        .voice-section {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
            border: 2px dashed var(--info);
        }

        .voice-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin: 10px 0;
        }

        .record-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--danger);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 10px rgba(220, 38, 38, 0.2);
            transition: all 0.3s;
        }

        .record-btn.recording {
            animation: pulse 1s infinite;
            background: #b91c1c;
        }

        .record-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .play-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s;
        }

        .play-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .audio-wave {
            flex: 1;
            height: 50px;
            background: white;
            border-radius: 25px;
            display: flex;
            align-items: center;
            padding: 0 15px;
            border: 2px solid var(--border);
            min-width: 100px;
        }

        .timer {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary);
            font-family: monospace;
        }

        .voice-status {
            font-size: 0.8rem;
            color: var(--info);
            margin-top: 5px;
            padding: 8px;
            background: rgba(255,255,255,0.7);
            border-radius: 20px;
            text-align: center;
        }

        .mic-permission-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 0;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .mic-permission-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .mic-permission-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .symptoms-text textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 0.95rem;
            resize: vertical;
            margin-top: 10px;
        }

        /* Analyze Button */
        .analyze-btn {
            width: 100%;
            padding: 16px;
            font-size: 1.3rem;
            background: linear-gradient(135deg, #f97316, #dc2626);
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(249,115,22,0.3);
            transition: all 0.3s;
        }

        .analyze-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Results Card with Doctor Advice */
        .results-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border-left: 5px solid var(--primary);
        }

        .print-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
        }

        .print-header h1 {
            color: var(--primary);
            font-size: 1.8rem;
        }

        .print-header p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .diagnosis-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .diagnosis-icon {
            font-size: 2.5rem;
        }

        .diagnosis-info {
            flex: 1;
        }

        .diagnosis-info h2 {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .patient-details-print {
            background: var(--light);
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 0.95rem;
        }

        .patient-details-print p {
            margin: 5px 0;
        }

        .severity-badge {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: 600;
            margin: 5px 0;
        }

        .severity-low {
            background: #dcfce7;
            color: #166534;
        }

        .severity-medium {
            background: #fed7aa;
            color: #9a3412;
        }

        .severity-high {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Doctor Advice Section */
        .doctor-advice-section {
            background: linear-gradient(135deg, #fff3e0, #ffe4bc);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            border: 2px solid var(--warning);
        }

        .doctor-advice-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .doctor-advice-header h3 {
            color: var(--warning);
            font-size: 1.2rem;
        }

        .doctor-icon {
            font-size: 1.8rem;
        }

        .doctor-message {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid var(--warning);
            font-style: italic;
        }

        .doctor-advice-input {
            margin-top: 15px;
        }

        .doctor-advice-input textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 10px;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .doctor-advice-actions {
            display: flex;
            gap: 10px;
        }

        .recommendation-box {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            border: 2px solid var(--success);
        }

        .recommendation-box.consult-doctor {
            border-color: var(--danger);
            background: #fff5f5;
        }

        .recommendation-box h3 {
            color: var(--success);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .recommendation-box.consult-doctor h3 {
            color: var(--danger);
        }

        .medicine-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .medicine-item {
            background: var(--light);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .medicine-item strong {
            color: var(--primary);
            display: block;
            margin-bottom: 3px;
        }

        .warning-signs {
            background: #fee2e2;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            color: #991b1b;
            font-weight: 500;
        }

        .disease-info {
            background: var(--light);
            padding: 12px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .disease-info h3 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .disease-info ul {
            padding-left: 20px;
            font-size: 0.9rem;
        }

        .disease-info li {
            margin: 4px 0;
        }

        .symptom-match {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin: 8px 0;
        }

        .match-tag {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .match-high {
            background: #dcfce7;
            color: #166534;
        }

        .match-medium {
            background: #fed7aa;
            color: #9a3412;
        }

        .match-low {
            background: #fee2e2;
            color: #991b1b;
        }

        .result-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        /* Print-specific styles */
        @media print {
            body {
                background: white;
                padding: 20px;
            }
            
            .login-container, .language-bar, .stats-grid, .form-section, 
            .symptom-checker, .voice-section, .analyze-btn, .disease-library, 
            .recent-section, .result-actions, .toast, .mic-permission-btn,
            .logout-btn, .doctor-advice-input, .doctor-advice-actions {
                display: none !important;
            }
            
            .results-card {
                display: block !important;
                box-shadow: none;
                border: 2px solid #000;
                padding: 20px;
                margin: 0;
                page-break-inside: avoid;
            }
            
            .print-header {
                display: block !important;
            }
            
            .diagnosis-header {
                background: none;
                border: 1px solid #ccc;
            }
            
            .recommendation-box, .disease-info, .doctor-advice-section {
                border: 1px solid #ccc;
                page-break-inside: avoid;
            }
            
            .severity-badge {
                border: 1px solid #000;
            }
        }

        /* Disease Library - Enhanced */
        .disease-library {
            background: white;
            border-radius: 16px;
            padding: 16px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .library-stats {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .library-stat-badge {
            background: var(--light);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .search-box {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 12px;
            margin: 15px 0;
            font-size: 0.95rem;
        }

        .category-filters {
            display: flex;
            gap: 6px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .category-filter-btn {
            padding: 4px 10px;
            border: 1px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.75rem;
        }

        .category-filter-btn.active {
            background: var(--primary);
            color: white;
        }

        .disease-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            max-height: 500px;
            overflow-y: auto;
            padding: 5px;
        }

        .disease-card {
            background: var(--light);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .disease-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .disease-card h3 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 1.2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .disease-category {
            font-size: 0.7rem;
            background: var(--primary);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
        }

        .disease-preview {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .preview-symptom {
            background: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            color: var(--gray);
        }

        .disease-full-details {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px dashed var(--primary);
        }

        .disease-full-details.show {
            display: block;
        }

        .detail-section {
            margin: 15px 0;
            padding: 12px;
            background: white;
            border-radius: 10px;
        }

        .detail-section h4 {
            color: var(--primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .detail-section ul {
            padding-left: 20px;
        }

        .detail-section li {
            margin: 5px 0;
        }

        .read-more-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            margin-top: 10px;
        }

        /* Recent Diagnoses Table */
        .recent-section {
            background: white;
            border-radius: 16px;
            padding: 16px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .table-container {
            overflow-x: auto;
            margin-top: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        th {
            background: var(--primary);
            color: white;
            padding: 10px;
            text-align: left;
        }

        td {
            padding: 8px;
            border-bottom: 1px solid var(--border);
        }

        .status-badge {
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-badge.low {
            background: #dcfce7;
            color: #166534;
        }

        .status-badge.medium {
            background: #fed7aa;
            color: #9a3412;
        }

        .status-badge.high {
            background: #fee2e2;
            color: #991b1b;
        }

        .action-btn {
            padding: 4px 8px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: var(--gray);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        /* Loading Spinner */
        .loading {
            text-align: center;
            padding: 20px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 15px;
            left: 15px;
            right: 15px;
            background: var(--success);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateY(200px);
            transition: transform 0.3s;
            z-index: 1000;
            text-align: center;
        }

        .toast.show {
            transform: translateY(0);
        }

        .toast.error {
            background: var(--danger);
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-logo">üè•</div>
        <h1 class="login-title">RuralCare AI</h1>
        <p class="login-subtitle">Patient Portal Login</p>
        
        <div class="login-form">
            <div class="login-input-group">
                <label>üìß Email or Phone Number</label>
                <input type="text" id="loginUsername" placeholder="Enter email or mobile number" value="patient@demo.com">
            </div>
            
            <div class="login-input-group">
                <label>üîí Password</label>
                <input type="password" id="loginPassword" placeholder="Enter password" value="demo123">
            </div>
            
            <button class="login-btn" onclick="handleLogin()">Login to Dashboard</button>
            
            <div class="demo-credentials">
                <p><strong>üîë Demo Credentials:</strong></p>
                <p>Email: patient@demo.com</p>
                <p>Password: demo123</p>
                <p style="margin-top: 8px; color: var(--primary);">üëÜ Use these to login</p>
            </div>
        </div>
    </div>

    <!-- Main Application (Hidden by default) -->
    <div id="mainApp">
        <!-- Language Switcher -->
        <div class="language-bar">
            <button class="lang-btn active" onclick="switchLanguage('en')" id="langEn">English</button>
            <button class="lang-btn" onclick="switchLanguage('ta')" id="langTa">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button>
            <button class="lang-btn" onclick="switchLanguage('te')" id="langTe">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</button>
            <button class="lang-btn" onclick="switchLanguage('kn')" id="langKn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</button>
            <button class="lang-btn" onclick="switchLanguage('hi')" id="langHi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
            <button class="lang-btn" onclick="switchLanguage('ml')" id="langMl">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</button>
        </div>

        <!-- Header with Logout -->
        <header class="header">
            <div>
                <h1 id="appName">üè• RuralCare AI</h1>
                <p id="appSubtitle">Complete Health Portal with Disease Library</p>
            </div>
            <button class="logout-btn" onclick="handleLogout()">Logout</button>
        </header>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <span class="number" id="totalDiagnoses">0</span>
                <span class="label" id="totalLabel">Total Visits</span>
            </div>
            <div class="stat-card">
                <span class="number" id="todayDiagnoses">0</span>
                <span class="label" id="todayLabel">Today</span>
            </div>
            <div class="stat-card">
                <span class="number" id="highRisk">0</span>
                <span class="label" id="highRiskLabel">High Risk</span>
            </div>
        </div>

        <!-- Patient Information Section -->
        <div class="form-section">
            <div class="section-header">
                <span class="icon">üìã</span>
                <h2 id="patientInfoTitle">Patient Information</h2>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label id="fullNameLabel">Full Name *</label>
                    <input type="text" id="patientName" placeholder="Enter name">
                </div>
                <div class="form-group">
                    <label id="ageLabel">Age *</label>
                    <input type="number" id="patientAge" min="0" max="120" placeholder="Years">
                </div>
                <div class="form-group">
                    <label id="genderLabel">Gender</label>
                    <select id="patientGender">
                        <option value="male" id="maleOption">Male</option>
                        <option value="female" id="femaleOption">Female</option>
                        <option value="other" id="otherOption">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label id="districtLabel">District *</label>
                    <select id="patientDistrict">
                        <option value="">Select District</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- AI Symptom Checker -->
        <div class="symptom-checker">
            <div class="section-header">
                <span class="icon">üîç</span>
                <h2 id="symptomCheckerTitle">AI Symptom Checker</h2>
            </div>
            
            <div class="symptom-categories" id="symptomCategories">
                <button class="category-btn active" onclick="filterSymptoms('all')" id="allCat">All</button>
                <button class="category-btn" onclick="filterSymptoms('respiratory')" id="respCat">Respiratory</button>
                <button class="category-btn" onclick="filterSymptoms('digestive')" id="digCat">Digestive</button>
                <button class="category-btn" onclick="filterSymptoms('neurological')" id="neuroCat">Neuro</button>
                <button class="category-btn" onclick="filterSymptoms('muscular')" id="muscCat">Muscular</button>
                <button class="category-btn" onclick="filterSymptoms('skin')" id="skinCat">Skin</button>
                <button class="category-btn" onclick="filterSymptoms('general')" id="genCat">General</button>
                <button class="category-btn" onclick="filterSymptoms('cardiovascular')" id="cardioCat">Cardio</button>
                <button class="category-btn" onclick="filterSymptoms('metabolic')" id="metaCat">Metabolic</button>
                <button class="category-btn" onclick="filterSymptoms('infectious')" id="infCat">Infectious</button>
            </div>

            <div class="symptoms-grid" id="symptomsGrid">
                <!-- Symptoms will be populated by JavaScript -->
            </div>

            <div class="selected-symptoms">
                <h3 id="selectedSymptomsTitle">Selected Symptoms:</h3>
                <div class="symptom-tags" id="symptomTags">
                    <p style="color: var(--gray);" id="noSymptomsText">None selected</p>
                </div>
            </div>
        </div>

        <!-- Voice Recording Section -->
        <div class="voice-section">
            <div class="section-header">
                <span class="icon">üé§</span>
                <h2 id="voiceTitle">Voice Recording</h2>
            </div>
            
            <!-- Microphone Permission Button -->
            <button class="mic-permission-btn" id="micPermissionBtn" onclick="requestMicrophonePermission()">
                üé§ Click to Allow Microphone Access
            </button>
            
            <div class="voice-controls" id="voiceControls" style="display: none;">
                <button class="record-btn" id="recordBtn" onclick="toggleRecording()">‚è∫Ô∏è</button>
                <button class="play-btn" id="playBtn" onclick="playRecording()" disabled>‚ñ∂Ô∏è</button>
                <div class="audio-wave" id="audioWave">
                    <span class="timer" id="timer">00:00</span>
                </div>
            </div>
            <div class="voice-status" id="voiceStatus">Click the button above to enable microphone</div>

            <div class="symptoms-text">
                <textarea id="symptomsText" placeholder="Or type symptoms..." rows="2"></textarea>
            </div>
        </div>

        <!-- Analyze Button -->
        <button class="analyze-btn" onclick="analyzeHealth()" id="analyzeBtn">
            üî¨ Analyze Health Status
        </button>

        <!-- Results Card with Doctor Advice -->
        <div id="results" class="results-card" style="display: none;"></div>

        <!-- Enhanced Disease Library -->
        <div class="disease-library">
            <div class="section-header">
                <span class="icon">üìö</span>
                <h2 id="libraryTitle">Complete Disease Library</h2>
            </div>

            <div class="library-stats">
                <span class="library-stat-badge" id="totalDiseases">30+ Diseases</span>
                <span class="library-stat-badge" id="totalCategories">10 Categories</span>
            </div>

            <div class="category-filters" id="diseaseCategoryFilters">
                <button class="category-filter-btn active" onclick="filterDiseasesByCategory('all')">All</button>
                <button class="category-filter-btn" onclick="filterDiseasesByCategory('respiratory')">Respiratory</button>
                <button class="category-filter-btn" onclick="filterDiseasesByCategory('digestive')">Digestive</button>
                <button class="category-filter-btn" onclick="filterDiseasesByCategory('neurological')">Neurological</button>
                <button class="category-filter-btn" onclick="filterDiseasesByCategory('cardiovascular')">Cardio</button>
                <button class="category-filter-btn" onclick="filterDiseasesByCategory('infectious')">Infectious</button>
                <button class="category-filter-btn" onclick="filterDiseasesByCategory('metabolic')">Metabolic</button>
                <button class="category-filter-btn" onclick="filterDiseasesByCategory('skin')">Skin</button>
                <button class="category-filter-btn" onclick="filterDiseasesByCategory('muscular')">Muscular</button>
            </div>

            <input type="text" class="search-box" id="diseaseSearch" placeholder="üîç Search diseases by name, symptoms, or causes..." onkeyup="searchDiseases()">

            <div class="disease-grid" id="diseaseGrid">
                <!-- Diseases will be populated by JavaScript -->
            </div>
        </div>

        <!-- Recent Diagnoses -->
        <div class="recent-section">
            <div class="section-header">
                <span class="icon">üìä</span>
                <h2 id="recentTitle">Recent Diagnoses</h2>
            </div>

            <div class="table-container">
                <table id="diagnosesTable">
                    <thead>
                        <tr>
                            <th id="dateCol">Date</th>
                            <th id="patientCol">Patient</th>
                            <th id="districtCol">District</th>
                            <th id="diagnosisCol">Diagnosis</th>
                            <th id="severityCol">Severity</th>
                            <th id="doctorCol">Doctor Advice</th>
                            <th id="actionCol">Action</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr><td colspan="7" style="text-align: center;" id="noDataText">No diagnoses yet</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Toast Notification -->
        <div class="toast" id="toast">Message</div>
    </div>

    <script>
        // ==================== TAMIL NADU DISTRICTS ====================
        const tamilNaduDistricts = [
            'Ariyalur', 'Chengalpattu', 'Chennai', 'Coimbatore', 'Cuddalore',
            'Dharmapuri', 'Dindigul', 'Erode', 'Kallakurichi', 'Kanchipuram',
            'Kanyakumari', 'Karur', 'Krishnagiri', 'Madurai', 'Mayiladuthurai',
            'Nagapattinam', 'Namakkal', 'Nilgiris', 'Perambalur', 'Pudukkottai',
            'Ramanathapuram', 'Ranipet', 'Salem', 'Sivaganga', 'Tenkasi',
            'Thanjavur', 'Theni', 'Thoothukkudi', 'Tiruchirappalli', 'Tirunelveli',
            'Tirupathur', 'Tiruppur', 'Tiruvallur', 'Tiruvannamalai', 'Tiruvarur',
            'Vellore', 'Viluppuram', 'Virudhunagar'
        ];

        // ==================== SYMPTOMS DATABASE ====================
        const symptomsDatabase = [
            { id: 1, name: 'Cough', category: 'respiratory' },
            { id: 2, name: 'Shortness of breath', category: 'respiratory' },
            { id: 3, name: 'Wheezing', category: 'respiratory' },
            { id: 4, name: 'Chest pain', category: 'respiratory' },
            { id: 5, name: 'Sore throat', category: 'respiratory' },
            { id: 6, name: 'Runny nose', category: 'respiratory' },
            { id: 7, name: 'Sneezing', category: 'respiratory' },
            { id: 8, name: 'Nasal congestion', category: 'respiratory' },
            { id: 9, name: 'Nausea', category: 'digestive' },
            { id: 10, name: 'Vomiting', category: 'digestive' },
            { id: 11, name: 'Diarrhea', category: 'digestive' },
            { id: 12, name: 'Constipation', category: 'digestive' },
            { id: 13, name: 'Abdominal pain', category: 'digestive' },
            { id: 14, name: 'Bloating', category: 'digestive' },
            { id: 15, name: 'Heartburn', category: 'digestive' },
            { id: 16, name: 'Loss of appetite', category: 'digestive' },
            { id: 17, name: 'Headache', category: 'neurological' },
            { id: 18, name: 'Dizziness', category: 'neurological' },
            { id: 19, name: 'Confusion', category: 'neurological' },
            { id: 20, name: 'Seizures', category: 'neurological' },
            { id: 21, name: 'Tremors', category: 'neurological' },
            { id: 22, name: 'Numbness', category: 'neurological' },
            { id: 23, name: 'Weakness', category: 'neurological' },
            { id: 24, name: 'Memory loss', category: 'neurological' },
            { id: 25, name: 'Joint pain', category: 'muscular' },
            { id: 26, name: 'Muscle pain', category: 'muscular' },
            { id: 27, name: 'Back pain', category: 'muscular' },
            { id: 28, name: 'Neck pain', category: 'muscular' },
            { id: 29, name: 'Swelling', category: 'muscular' },
            { id: 30, name: 'Stiffness', category: 'muscular' },
            { id: 31, name: 'Rash', category: 'skin' },
            { id: 32, name: 'Itching', category: 'skin' },
            { id: 33, name: 'Hives', category: 'skin' },
            { id: 34, name: 'Dry skin', category: 'skin' },
            { id: 35, name: 'Blisters', category: 'skin' },
            { id: 36, name: 'Redness', category: 'skin' },
            { id: 37, name: 'Fever', category: 'general' },
            { id: 38, name: 'Fatigue', category: 'general' },
            { id: 39, name: 'Chills', category: 'general' },
            { id: 40, name: 'Night sweats', category: 'general' },
            { id: 41, name: 'Weight loss', category: 'general' },
            { id: 42, name: 'Weight gain', category: 'general' },
            { id: 43, name: 'Dehydration', category: 'general' },
            { id: 44, name: 'Palpitations', category: 'cardiovascular' },
            { id: 45, name: 'High BP', category: 'cardiovascular' },
            { id: 46, name: 'Low BP', category: 'cardiovascular' },
            { id: 47, name: 'Excessive thirst', category: 'metabolic' },
            { id: 48, name: 'Frequent urination', category: 'metabolic' },
            { id: 49, name: 'Blurred vision', category: 'metabolic' },
            { id: 50, name: 'Swollen lymph nodes', category: 'infectious' },
            { id: 51, name: 'Body aches', category: 'infectious' }
        ];

        // ==================== ENHANCED DISEASE DATABASE with 30+ Diseases ====================
        const diseaseDatabase = [
            // Respiratory Diseases
            {
                id: 1, name: 'Common Cold', category: 'respiratory',
                symptoms: [1, 5, 6, 7, 8, 37],
                severity: 'low',
                description: 'Viral infection of upper respiratory tract',
                causes: ['Rhinoviruses', 'Coronaviruses', 'RSV'],
                about: 'The common cold is a viral infection of your nose and throat (upper respiratory tract). It is usually harmless, although it might not feel that way. Many types of viruses can cause a common cold.',
                riskFactors: ['Close contact with infected persons', 'Weakened immune system', 'Smoking', 'Stress'],
                complications: ['Sinusitis', 'Ear infections', 'Asthma flare-ups'],
                prevention: ['Wash hands frequently', 'Avoid touching face', 'Disinfect surfaces', 'Avoid close contact with sick people'],
                recommendations: ['Rest and stay hydrated', 'Use saline nasal spray', 'Gargle with warm salt water'],
                medicines: [
                    { name: 'Paracetamol', dosage: '650mg every 6-8 hours for fever' },
                    { name: 'Cetirizine', dosage: '10mg once daily for runny nose' },
                    { name: 'Cough syrup', dosage: '10ml three times daily' }
                ],
                homeRemedies: ['Warm water gargle', 'Honey with ginger tea', 'Steam inhalation', 'Chicken soup'],
                consultDoctor: false,
                warningSigns: ['High fever > 101¬∞F for more than 3 days', 'Difficulty breathing', 'Severe headache', 'Chest pain']
            },
            {
                id: 2, name: 'Influenza (Flu)', category: 'respiratory',
                symptoms: [1, 2, 37, 38, 39, 40, 51, 17],
                severity: 'medium',
                description: 'Viral infection affecting respiratory system',
                causes: ['Influenza A virus', 'Influenza B virus'],
                about: 'Influenza is a viral infection that attacks your respiratory system ‚Äî your nose, throat and lungs. Influenza is commonly called the flu, but it\'s not the same as stomach "flu" viruses that cause diarrhea and vomiting.',
                riskFactors: ['Age (young children and elderly)', 'Pregnancy', 'Weakened immune system', 'Chronic illnesses', 'Obesity'],
                complications: ['Pneumonia', 'Bronchitis', 'Sinus infections', 'Ear infections', 'Myocarditis'],
                prevention: ['Annual flu vaccine', 'Hand hygiene', 'Avoid crowded places', 'Cover mouth when coughing'],
                recommendations: ['Rest and isolate', 'Take antiviral medications if prescribed', 'Stay hydrated', 'Use fever reducers'],
                medicines: [
                    { name: 'Oseltamivir', dosage: '75mg twice daily for 5 days (prescription required)' },
                    { name: 'Paracetamol', dosage: '650mg every 6 hours for fever' },
                    { name: 'Cough suppressant', dosage: 'As directed' }
                ],
                homeRemedies: ['Warm fluids', 'Honey and lemon tea', 'Rest in well-ventilated room', 'Humidifier'],
                consultDoctor: true,
                warningSigns: ['Difficulty breathing', 'Chest pain', 'Confusion', 'Severe vomiting', 'High fever > 103¬∞F']
            },
            {
                id: 3, name: 'Pneumonia', category: 'respiratory',
                symptoms: [1, 2, 4, 37, 38, 3, 23],
                severity: 'high',
                description: 'Infection of lung tissue',
                causes: ['Streptococcus pneumoniae', 'Mycoplasma pneumoniae', 'Viruses', 'Fungi'],
                about: 'Pneumonia is an infection that inflames the air sacs in one or both lungs. The air sacs may fill with fluid or pus, causing cough with phlegm or pus, fever, chills, and difficulty breathing.',
                riskFactors: ['Smoking', 'Chronic lung disease', 'Weakened immune system', 'Hospitalization', 'Age >65'],
                complications: ['Bacteremia', 'Lung abscess', 'Pleural effusion', 'Respiratory failure'],
                prevention: ['Vaccination', 'No smoking', 'Good hygiene', 'Healthy lifestyle'],
                recommendations: ['Immediate medical attention required', 'Take prescribed antibiotics', 'Rest and hydrate', 'Oxygen therapy if needed'],
                medicines: [
                    { name: 'Amoxicillin', dosage: '500mg three times daily (prescription only)' },
                    { name: 'Azithromycin', dosage: '500mg once daily (prescription only)' },
                    { name: 'Paracetamol', dosage: '650mg for fever' }
                ],
                homeRemedies: ['Steam inhalation', 'Warm compress for chest', 'Honey for cough', 'Breathing exercises'],
                consultDoctor: true,
                warningSigns: ['Severe difficulty breathing', 'Blue lips or face', 'Chest pain', 'High fever', 'Confusion']
            },
            {
                id: 4, name: 'Bronchitis', category: 'respiratory',
                symptoms: [1, 2, 3, 38, 4, 37],
                severity: 'medium',
                description: 'Inflammation of bronchial tubes',
                causes: ['Viruses', 'Bacteria', 'Smoking', 'Air pollution'],
                about: 'Bronchitis is an inflammation of the lining of your bronchial tubes, which carry air to and from your lungs. People who have bronchitis often cough up thickened mucus, which can be discolored.',
                riskFactors: ['Cigarette smoke', 'Low immunity', 'Gastric reflux', 'Exposure to irritants'],
                complications: ['Pneumonia', 'Chronic bronchitis', 'Asthma'],
                prevention: ['Avoid smoking', 'Wear mask in polluted areas', 'Wash hands', 'Get vaccinated'],
                recommendations: ['Rest', 'Drink fluids', 'Use humidifier', 'Avoid lung irritants'],
                medicines: [
                    { name: 'Cough suppressant', dosage: 'As directed' },
                    { name: 'Bronchodilators', dosage: 'As prescribed for wheezing' },
                    { name: 'Paracetamol', dosage: '650mg for fever' }
                ],
                homeRemedies: ['Honey', 'Ginger tea', 'Steam inhalation', 'Salt water gargle'],
                consultDoctor: true,
                warningSigns: ['Fever > 100.4¬∞F', 'Coughing up blood', 'Shortness of breath', 'Symptoms > 3 weeks']
            },
            {
                id: 5, name: 'Tuberculosis', category: 'infectious',
                symptoms: [1, 2, 4, 37, 38, 41, 40],
                severity: 'high',
                description: 'Bacterial infection affecting lungs',
                causes: ['Mycobacterium tuberculosis'],
                about: 'Tuberculosis (TB) is a potentially serious infectious disease that mainly affects the lungs. The bacteria that cause TB are spread from person to person through tiny droplets released into the air via coughs and sneezes.',
                riskFactors: ['Weakened immune system', 'Close contact with TB patient', 'Living in crowded conditions', 'Malnutrition'],
                complications: ['Lung damage', 'Spread to other organs', 'Meningitis', 'Joint damage'],
                prevention: ['BCG vaccination', 'Avoid close contact with active TB patients', 'Ventilation', 'Mask use'],
                recommendations: ['Complete full course of antibiotics', 'Isolate initially', 'Nutritious diet', 'Regular follow-up'],
                medicines: [
                    { name: 'Isoniazid', dosage: 'As prescribed (6-9 months)' },
                    { name: 'Rifampin', dosage: 'As prescribed' },
                    { name: 'Ethambutol', dosage: 'As prescribed' }
                ],
                homeRemedies: ['Nutritious diet', 'Rest', 'Good ventilation', 'Mask usage'],
                consultDoctor: true,
                warningSigns: ['Coughing blood', 'Severe chest pain', 'Difficulty breathing', 'High fever']
            },
            
            // Digestive Diseases
            {
                id: 6, name: 'Gastroenteritis', category: 'digestive',
                symptoms: [9, 10, 11, 13, 37, 38, 43],
                severity: 'medium',
                description: 'Stomach flu - inflammation of stomach and intestines',
                causes: ['Norovirus', 'Rotavirus', 'Bacteria (E. coli, Salmonella)', 'Parasites'],
                about: 'Gastroenteritis is an inflammation of the lining of the intestines caused by a virus, bacteria, or parasites. Viral gastroenteritis is the second most common illness in the U.S.',
                riskFactors: ['Poor hand washing', 'Contaminated food/water', 'Close contact with infected', 'Weak immune system'],
                complications: ['Severe dehydration', 'Electrolyte imbalance', 'Kidney failure'],
                prevention: ['Hand washing', 'Safe food handling', 'Drink clean water', 'Avoid contaminated food'],
                recommendations: ['Oral rehydration', 'BRAT diet', 'Rest', 'Avoid dairy and spicy food'],
                medicines: [
                    { name: 'ORS', dosage: 'As needed for dehydration' },
                    { name: 'Zinc supplements', dosage: '20mg daily' },
                    { name: 'Paracetamol', dosage: '650mg for fever' }
                ],
                homeRemedies: ['Coconut water', 'Rice water', 'Bananas', 'Ginger tea'],
                consultDoctor: true,
                warningSigns: ['Blood in stool', 'Severe dehydration', 'High fever', 'Unable to keep fluids down']
            },
            {
                id: 7, name: 'Acid Reflux (GERD)', category: 'digestive',
                symptoms: [15, 14, 13, 16, 5],
                severity: 'low',
                description: 'Chronic acid reflux disease',
                causes: ['Weak lower esophageal sphincter', 'Hiatal hernia', 'Obesity', 'Pregnancy'],
                about: 'Gastroesophageal reflux disease (GERD) occurs when stomach acid frequently flows back into the tube connecting your mouth and stomach (esophagus). This backwash (acid reflux) can irritate the lining of your esophagus.',
                riskFactors: ['Obesity', 'Hiatal hernia', 'Pregnancy', 'Smoking', 'Dry mouth', 'Asthma', 'Diabetes'],
                complications: ['Esophagitis', 'Esophageal stricture', 'Barrett\'s esophagus', 'Esophageal cancer'],
                prevention: ['Maintain healthy weight', 'Avoid trigger foods', 'Eat smaller meals', 'Don\'t lie down after eating'],
                recommendations: ['Elevate head of bed', 'Avoid spicy/fatty foods', 'Eat small meals', 'No eating 3 hours before bedtime'],
                medicines: [
                    { name: 'Omeprazole', dosage: '20mg once daily before meal' },
                    { name: 'Ranitidine', dosage: '150mg twice daily' },
                    { name: 'Antacids', dosage: 'As needed' }
                ],
                homeRemedies: ['Ginger tea', 'Aloe vera juice', 'Chewing gum', 'Apple cider vinegar (diluted)'],
                consultDoctor: false,
                warningSigns: ['Difficulty swallowing', 'Unexplained weight loss', 'Chest pain', 'Vomiting blood']
            },
            {
                id: 8, name: 'Peptic Ulcer', category: 'digestive',
                symptoms: [13, 15, 9, 16, 41],
                severity: 'medium',
                description: 'Sores in stomach lining',
                causes: ['H. pylori bacteria', 'NSAIDs overuse', 'Excess acid', 'Smoking'],
                about: 'Peptic ulcers are open sores that develop on the inside lining of your stomach and the upper portion of your small intestine. The most common symptom of a peptic ulcer is stomach pain.',
                riskFactors: ['H. pylori infection', 'Regular NSAID use', 'Smoking', 'Alcohol', 'Stress', 'Spicy foods'],
                complications: ['Internal bleeding', 'Perforation', 'Gastric outlet obstruction', 'Stomach cancer'],
                prevention: ['Limit NSAIDs', 'Treat H. pylori', 'Avoid alcohol', 'Quit smoking', 'Manage stress'],
                recommendations: ['Take prescribed antibiotics', 'Avoid NSAIDs', 'Eat small meals', 'Avoid trigger foods'],
                medicines: [
                    { name: 'Amoxicillin', dosage: '500mg three times daily (for H. pylori)' },
                    { name: 'Omeprazole', dosage: '20mg twice daily' },
                    { name: 'Metronidazole', dosage: '500mg three times daily' }
                ],
                homeRemedies: ['Cabbage juice', 'Bananas', 'Honey', 'Garlic'],
                consultDoctor: true,
                warningSigns: ['Black/bloody stool', 'Vomiting blood', 'Severe abdominal pain', 'Weight loss']
            },
            {
                id: 9, name: 'Hepatitis A', category: 'infectious',
                symptoms: [37, 38, 16, 9, 13, 40],
                severity: 'medium',
                description: 'Liver infection from hepatitis A virus',
                causes: ['Hepatitis A virus', 'Contaminated food/water'],
                about: 'Hepatitis A is a highly contagious liver infection caused by the hepatitis A virus. It is usually transmitted through the fecal-oral route, either from person-to-person contact or consumption of contaminated food or water.',
                riskFactors: ['Travel to endemic areas', 'Eating contaminated food', 'Close contact with infected', 'Men who have sex with men'],
                complications: ['Liver failure', 'Cholestatic hepatitis', 'Relapsing hepatitis'],
                prevention: ['Hepatitis A vaccine', 'Good hygiene', 'Safe food handling', 'Avoid contaminated water'],
                recommendations: ['Rest', 'Avoid alcohol', 'Healthy diet', 'Hydration'],
                medicines: [
                    { name: 'Supportive care', dosage: 'No specific antiviral' },
                    { name: 'Anti-nausea meds', dosage: 'As needed' }
                ],
                homeRemedies: ['Rest', 'Small frequent meals', 'Avoid fatty foods', 'Stay hydrated'],
                consultDoctor: true,
                warningSigns: ['Jaundice', 'Severe vomiting', 'Abdominal swelling', 'Confusion']
            },
            
            // Neurological Diseases
            {
                id: 10, name: 'Migraine', category: 'neurological',
                symptoms: [17, 9, 10, 18, 49],
                severity: 'medium',
                description: 'Severe recurring headaches',
                causes: ['Genetics', 'Environmental factors', 'Neurological disorder'],
                about: 'A migraine is a headache of varying intensity, often accompanied by nausea and sensitivity to light and sound. Migraine is a neurological condition that can cause multiple symptoms.',
                riskFactors: ['Family history', 'Age', 'Gender (women more common)', 'Hormonal changes'],
                triggers: ['Stress', 'Certain foods', 'Caffeine', 'Weather changes', 'Sleep changes', 'Hormones'],
                prevention: ['Identify triggers', 'Regular sleep', 'Stress management', 'Regular exercise'],
                recommendations: ['Rest in dark quiet room', 'Apply cold compress', 'Stay hydrated', 'Avoid triggers'],
                medicines: [
                    { name: 'Ibuprofen', dosage: '400-600mg at onset' },
                    { name: 'Sumatriptan', dosage: 'As prescribed' },
                    { name: 'Paracetamol', dosage: '650mg' }
                ],
                homeRemedies: ['Cold compress', 'Caffeine (small amount)', 'Rest in dark room', 'Peppermint oil'],
                consultDoctor: true,
                warningSigns: ['Sudden severe headache', 'With fever/stiff neck', 'After head injury', 'With confusion']
            },
            {
                id: 11, name: 'Epilepsy', category: 'neurological',
                symptoms: [20, 19, 23, 24],
                severity: 'high',
                description: 'Neurological disorder causing seizures',
                causes: ['Genetic factors', 'Head trauma', 'Brain conditions', 'Infections', 'Prenatal injury'],
                about: 'Epilepsy is a central nervous system (neurological) disorder in which brain activity becomes abnormal, causing seizures or periods of unusual behavior, sensations, and sometimes loss of awareness.',
                riskFactors: ['Age', 'Family history', 'Head injuries', 'Stroke', 'Dementia', 'Brain infections'],
                complications: ['Injury during seizure', 'Status epilepticus', 'Sudep', 'Depression', 'Learning difficulties'],
                prevention: ['Prevent head injuries', 'Reduce stroke risk', 'Proper prenatal care'],
                recommendations: ['Take medication regularly', 'Wear medical alert bracelet', 'Avoid triggers', 'Regular follow-up'],
                medicines: [
                    { name: 'Sodium valproate', dosage: 'As prescribed' },
                    { name: 'Carbamazepine', dosage: 'As prescribed' },
                    { name: 'Levetiracetam', dosage: 'As prescribed' }
                ],
                homeRemedies: ['Ketogenic diet (under supervision)', 'Stress reduction', 'Regular sleep', 'Avoid alcohol'],
                consultDoctor: true,
                warningSigns: ['Seizure >5 minutes', 'Difficulty breathing', 'Injury during seizure', 'Pregnancy']
            },
            {
                id: 12, name: 'Stroke', category: 'neurological',
                symptoms: [17, 18, 19, 22, 23, 24, 49],
                severity: 'high',
                description: 'Brain attack from interrupted blood supply',
                causes: ['Blood clot (ischemic)', 'Bleeding in brain (hemorrhagic)', 'High BP', 'Aneurysm'],
                about: 'A stroke occurs when the blood supply to part of your brain is interrupted or reduced, preventing brain tissue from getting oxygen and nutrients. Brain cells begin to die in minutes.',
                riskFactors: ['High BP', 'Smoking', 'Diabetes', 'Heart disease', 'Obesity', 'Age', 'Family history'],
                complications: ['Paralysis', 'Speech problems', 'Memory loss', 'Emotional problems', 'Pain', 'Difficulty eating'],
                prevention: ['Control BP', 'Healthy diet', 'Exercise', 'No smoking', 'Limit alcohol'],
                recommendations: ['Immediate emergency care', 'Rehabilitation', 'Medication adherence', 'Lifestyle changes'],
                medicines: [
                    { name: 'tPA', dosage: 'Clot-buster (emergency)' },
                    { name: 'Aspirin', dosage: '81-325mg daily' },
                    { name: 'Clopidogrel', dosage: '75mg daily' }
                ],
                homeRemedies: ['Rehabilitation exercises', 'Healthy diet', 'Support groups'],
                consultDoctor: true,
                warningSigns: ['Face drooping', 'Arm weakness', 'Speech difficulty', 'Time to call emergency']
            },
            
            // Cardiovascular Diseases
            {
                id: 13, name: 'Hypertension', category: 'cardiovascular',
                symptoms: [17, 18, 44, 49],
                severity: 'medium',
                description: 'High blood pressure',
                causes: ['Genetics', 'High salt intake', 'Obesity', 'Stress', 'Kidney disease'],
                about: 'High blood pressure is a common condition that affects the body\'s arteries. If you have high blood pressure, the force of the blood pushing against the artery walls is consistently too high.',
                riskFactors: ['Age', 'Family history', 'Obesity', 'Sedentary lifestyle', 'Smoking', 'High salt diet', 'Stress'],
                complications: ['Heart attack', 'Stroke', 'Aneurysm', 'Heart failure', 'Kidney damage', 'Vision loss'],
                prevention: ['Healthy diet', 'Reduce salt', 'Regular exercise', 'Healthy weight', 'Limit alcohol'],
                recommendations: ['Regular BP monitoring', 'Low salt diet', 'Exercise', 'Medication compliance'],
                medicines: [
                    { name: 'Amlodipine', dosage: '5-10mg once daily' },
                    { name: 'Losartan', dosage: '50mg once daily' },
                    { name: 'Hydrochlorothiazide', dosage: '12.5-25mg once daily' }
                ],
                homeRemedies: ['Garlic', 'Hibiscus tea', 'Reduce stress', 'Regular walking'],
                consultDoctor: true,
                warningSigns: ['BP >180/120', 'Chest pain', 'Severe headache', 'Shortness of breath']
            },
            {
                id: 14, name: 'Heart Attack', category: 'cardiovascular',
                symptoms: [4, 2, 40, 44, 9, 38],
                severity: 'high',
                description: 'Myocardial infarction',
                causes: ['Blocked coronary artery', 'Blood clot', 'Atherosclerosis'],
                about: 'A heart attack occurs when the flow of blood to the heart is severely reduced or blocked. The blockage is usually due to a buildup of fat, cholesterol and other substances in the heart arteries.',
                riskFactors: ['Age', 'Smoking', 'High BP', 'High cholesterol', 'Diabetes', 'Obesity', 'Family history'],
                complications: ['Arrhythmias', 'Heart failure', 'Cardiogenic shock', 'Valve problems'],
                prevention: ['Heart-healthy diet', 'Exercise', 'No smoking', 'Control BP/cholesterol', 'Manage diabetes'],
                recommendations: ['Emergency treatment', 'Cardiac rehab', 'Medication adherence', 'Lifestyle changes'],
                medicines: [
                    { name: 'Aspirin', dosage: '325mg chewed immediately' },
                    { name: 'Nitroglycerin', dosage: 'As prescribed' },
                    { name: 'Clopidogrel', dosage: '75mg daily' }
                ],
                homeRemedies: ['Healthy diet', 'Gradual exercise', 'Stress management'],
                consultDoctor: true,
                warningSigns: ['Chest pressure', 'Pain in arm/neck', 'Shortness of breath', 'Cold sweat']
            },
            
            // Metabolic Diseases
            {
                id: 15, name: 'Type 2 Diabetes', category: 'metabolic',
                symptoms: [47, 48, 38, 41, 49],
                severity: 'medium',
                description: 'Chronic condition affecting blood sugar',
                causes: ['Insulin resistance', 'Genetics', 'Obesity', 'Sedentary lifestyle'],
                about: 'Type 2 diabetes is an impairment in the way the body regulates and uses sugar (glucose) as a fuel. This long-term condition results in too much sugar circulating in the bloodstream.',
                riskFactors: ['Weight', 'Inactivity', 'Family history', 'Age >45', 'PCOS', 'High BP'],
                complications: ['Heart disease', 'Nerve damage', 'Kidney disease', 'Eye damage', 'Foot damage'],
                prevention: ['Healthy weight', 'Exercise', 'Healthy diet', 'Avoid sugary drinks'],
                recommendations: ['Monitor blood sugar', 'Healthy diet', 'Exercise', 'Medication compliance'],
                medicines: [
                    { name: 'Metformin', dosage: '500-1000mg twice daily' },
                    { name: 'Glibenclamide', dosage: '5mg once daily' },
                    { name: 'Insulin', dosage: 'As prescribed' }
                ],
                homeRemedies: ['Fenugreek seeds', 'Bitter gourd', 'Cinnamon', 'Regular walking'],
                consultDoctor: true,
                warningSigns: ['Blood sugar >300', 'Confusion', 'Fruity breath', 'Nausea/vomiting']
            },
            {
                id: 16, name: 'Hypothyroidism', category: 'metabolic',
                symptoms: [38, 41, 23, 42, 43],
                severity: 'low',
                description: 'Underactive thyroid',
                causes: ['Autoimmune disease', 'Thyroiditis', 'Iodine deficiency', 'Pituitary disorders'],
                about: 'Hypothyroidism is a condition in which your thyroid gland doesn\'t produce enough of certain crucial hormones. It can cause a variety of symptoms, from fatigue to weight gain.',
                riskFactors: ['Female gender', 'Age >60', 'Family history', 'Autoimmune disease', 'Pregnancy'],
                complications: ['Goiter', 'Heart problems', 'Mental health issues', 'Myxedema', 'Infertility'],
                prevention: ['Cannot prevent, but manage with medication'],
                recommendations: ['Daily thyroid medication', 'Regular blood tests', 'Healthy diet', 'Exercise'],
                medicines: [
                    { name: 'Levothyroxine', dosage: '25-150mcg once daily' }
                ],
                homeRemedies: ['No specific remedies', 'Take medication as prescribed'],
                consultDoctor: true,
                warningSigns: ['Severe fatigue', 'Depression', 'Cold intolerance', 'Weight gain']
            },
            
            // Skin Diseases
            {
                id: 17, name: 'Eczema', category: 'skin',
                symptoms: [31, 32, 34, 36],
                severity: 'low',
                description: 'Inflammatory skin condition',
                causes: ['Genetics', 'Immune system overreaction', 'Environmental triggers'],
                about: 'Atopic dermatitis (eczema) is a condition that makes your skin red and itchy. It\'s common in children but can occur at any age. It\'s a chronic condition and tends to flare periodically.',
                riskFactors: ['Family history', 'Asthma', 'Hay fever', 'Living in cities', 'Cold climates'],
                triggers: ['Dry skin', 'Irritants', 'Stress', 'Sweat', 'Infections', 'Allergens'],
                prevention: ['Moisturize regularly', 'Avoid triggers', 'Gentle skin care', 'Manage stress'],
                recommendations: ['Moisturize frequently', 'Avoid scratching', 'Use gentle soaps', 'Identify triggers'],
                medicines: [
                    { name: 'Hydrocortisone cream', dosage: 'Apply twice daily' },
                    { name: 'Antihistamines', dosage: 'As needed for itching' },
                    { name: 'Tacrolimus ointment', dosage: 'As prescribed' }
                ],
                homeRemedies: ['Coconut oil', 'Oatmeal baths', 'Aloe vera', 'Avoid hot showers'],
                consultDoctor: false,
                warningSigns: ['Signs of infection', 'Fever', 'Spreading redness', 'Pain']
            },
            {
                id: 18, name: 'Psoriasis', category: 'skin',
                symptoms: [31, 32, 35, 36],
                severity: 'medium',
                description: 'Autoimmune skin condition',
                causes: ['Immune system', 'Genetics', 'Triggers like stress/infection'],
                about: 'Psoriasis is a skin disease that causes a rash with itchy, scaly patches, most commonly on the knees, elbows, trunk and scalp. It is a common, long-term chronic disease with no cure.',
                riskFactors: ['Family history', 'Stress', 'Obesity', 'Smoking', 'Infections'],
                triggers: ['Stress', 'Infection', 'Weather', 'Injury to skin', 'Medications', 'Alcohol'],
                complications: ['Psoriatic arthritis', 'Eye conditions', 'Metabolic syndrome', 'CV disease'],
                prevention: ['Moisturize', 'Avoid triggers', 'Manage stress', 'Healthy lifestyle'],
                recommendations: ['Topical treatments', 'Phototherapy', 'Systemic medications', 'Avoid triggers'],
                medicines: [
                    { name: 'Topical corticosteroids', dosage: 'Apply as directed' },
                    { name: 'Vitamin D analogues', dosage: 'Apply twice daily' },
                    { name: 'Methotrexate', dosage: 'As prescribed' }
                ],
                homeRemedies: ['Aloe vera', 'Oatmeal baths', 'Moisturizers', 'Sunlight (moderate)'],
                consultDoctor: true,
                warningSigns: ['Joint pain', 'Widespread rash', 'Pustules', 'Fever']
            },
            
            // Infectious Diseases
            {
                id: 19, name: 'Malaria', category: 'infectious',
                symptoms: [37, 39, 40, 17, 38, 51],
                severity: 'high',
                description: 'Mosquito-borne parasitic disease',
                causes: ['Plasmodium parasites', 'Mosquito bites'],
                about: 'Malaria is a disease caused by a parasite. The parasite is spread to humans through the bites of infected mosquitoes. People who have malaria usually feel very sick with high fever and shaking chills.',
                riskFactors: ['Living in endemic areas', 'Travel to tropics', 'No preventive measures'],
                complications: ['Cerebral malaria', 'Anemia', 'Respiratory distress', 'Organ failure'],
                prevention: ['Mosquito nets', 'Repellents', 'Prophylactic medications', 'Remove standing water'],
                recommendations: ['Immediate treatment', 'Complete medication course', 'Rest', 'Hydration'],
                medicines: [
                    { name: 'Artemisinin combination', dosage: 'As prescribed' },
                    { name: 'Chloroquine', dosage: 'For sensitive strains' },
                    { name: 'Primaquine', dosage: 'For relapse prevention' }
                ],
                homeRemedies: ['Rest', 'Hydration', 'Fever management'],
                consultDoctor: true,
                warningSigns: ['Severe headache', 'Confusion', 'Seizures', 'Difficulty breathing']
            },
            {
                id: 20, name: 'Dengue Fever', category: 'infectious',
                symptoms: [37, 17, 51, 31, 9, 38],
                severity: 'high',
                description: 'Mosquito-borne viral infection',
                causes: ['Dengue virus', 'Aedes mosquito bite'],
                about: 'Dengue (break-bone fever) is a mosquito-borne viral infection occurring in tropical and subtropical areas. Mild dengue fever causes high fever and flu-like symptoms. Severe dengue can cause severe bleeding and death.',
                riskFactors: ['Living in tropics', 'Previous dengue infection', 'Weakened immunity'],
                complications: ['Dengue hemorrhagic fever', 'Dengue shock syndrome', 'Organ impairment'],
                prevention: ['Mosquito control', 'Repellents', 'Remove breeding sites', 'Protective clothing'],
                recommendations: ['Rest', 'Hydration', 'Monitor platelet count', 'No NSAIDs'],
                medicines: [
                    { name: 'Paracetamol', dosage: '650mg every 6 hours (no aspirin)' },
                    { name: 'IV fluids', dosage: 'If severe' }
                ],
                homeRemedies: ['Papaya leaf juice', 'Coconut water', 'Hydration', 'Rest'],
                consultDoctor: true,
                warningSigns: ['Severe abdominal pain', 'Bleeding', 'Vomiting', 'Rapid breathing']
            },
            
            // Muscular Diseases
            {
                id: 21, name: 'Arthritis', category: 'muscular',
                symptoms: [25, 26, 29, 30],
                severity: 'medium',
                description: 'Joint inflammation',
                causes: ['Autoimmune (RA)', 'Wear and tear (OA)', 'Infection', 'Injury'],
                about: 'Arthritis is inflammation of one or more joints. The main symptoms of arthritis are joint pain and stiffness, which typically worsen with age. The two most common types are osteoarthritis and rheumatoid arthritis.',
                riskFactors: ['Age', 'Family history', 'Obesity', 'Joint injury', 'Infection', 'Occupation'],
                complications: ['Joint deformity', 'Difficulty walking', 'Depression', 'Weight gain'],
                prevention: ['Exercise', 'Healthy weight', 'Protect joints', 'No smoking'],
                recommendations: ['Pain management', 'Physical therapy', 'Exercise', 'Joint protection'],
                medicines: [
                    { name: 'Ibuprofen', dosage: '400mg three times daily' },
                    { name: 'Paracetamol', dosage: '650mg as needed' },
                    { name: 'Methotrexate', dosage: 'For RA as prescribed' }
                ],
                homeRemedies: ['Hot/cold therapy', 'Gentle exercise', 'Turmeric', 'Epsom salt baths'],
                consultDoctor: true,
                warningSigns: ['Severe joint pain', 'Fever', 'Red/hot joint', 'Difficulty moving']
            },
            {
                id: 22, name: 'Osteoporosis', category: 'muscular',
                symptoms: [27, 41, 25],
                severity: 'medium',
                description: 'Brittle bones from bone loss',
                causes: ['Aging', 'Hormonal changes', 'Calcium deficiency', 'Genetics'],
                about: 'Osteoporosis causes bones to become weak and brittle ‚Äî so brittle that a fall or even mild stresses like bending over or coughing can cause a fracture. Osteoporosis-related fractures most commonly occur in the hip, wrist or spine.',
                riskFactors: ['Age >50', 'Female', 'Family history', 'Low calcium', 'Smoking', 'Alcohol'],
                complications: ['Fractures', 'Loss of height', 'Stooped posture', 'Disability'],
                prevention: ['Calcium/vitamin D', 'Weight-bearing exercise', 'No smoking', 'Limit alcohol'],
                recommendations: ['Calcium supplements', 'Vitamin D', 'Weight-bearing exercise', 'Fall prevention'],
                medicines: [
                    { name: 'Calcium', dosage: '1000-1200mg daily' },
                    { name: 'Vitamin D', dosage: '800-1000 IU daily' },
                    { name: 'Alendronate', dosage: '70mg weekly' }
                ],
                homeRemedies: ['Calcium-rich foods', 'Sunlight', 'Exercise', 'Quit smoking'],
                consultDoctor: true,
                warningSigns: ['Fracture from minor injury', 'Height loss', 'Stooped posture']
            }
        ];

        // ==================== STATE VARIABLES ====================
        let currentUser = null;
        let diagnoses = JSON.parse(localStorage.getItem('diagnoses') || '[]');
        let selectedSymptoms = [];
        let currentSymptomCategory = 'all';
        let currentDiseaseCategory = 'all';
        let mediaRecorder = null;
        let audioChunks = [];
        let audioBlob = null;
        let audioUrl = null;
        let isRecording = false;
        let recordingTimer = null;
        let recordingSeconds = 0;
        let microphonePermission = false;
        let mediaStream = null;

        // ==================== LOGIN FUNCTIONS ====================
        function handleLogin() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            // Simple demo authentication
            if (username === 'patient@demo.com' && password === 'demo123') {
                currentUser = { name: 'Demo Patient', email: username };
                
                // Hide login page and show main app
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                
                // Initialize the app after login
                loadDistricts();
                loadSymptoms();
                loadDiseaseLibrary();
                updateStats();
                displayDiagnoses();
                
                showToast('Login successful! Welcome to RuralCare AI', 'success');
            } else {
                showToast('Invalid credentials! Use demo account', 'error');
            }
        }

        function handleLogout() {
            currentUser = null;
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginPage').style.display = 'block';
            document.getElementById('loginUsername').value = 'patient@demo.com';
            document.getElementById('loginPassword').value = 'demo123';
            showToast('Logged out successfully', 'success');
        }

        // ==================== MICROPHONE PERMISSION ====================
        async function requestMicrophonePermission() {
            try {
                document.getElementById('voiceStatus').textContent = 'Requesting microphone access...';
                document.getElementById('micPermissionBtn').disabled = true;
                
                mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                // Stop the stream immediately - we just wanted permission
                mediaStream.getTracks().forEach(track => track.stop());
                
                microphonePermission = true;
                document.getElementById('micPermissionBtn').style.display = 'none';
                document.getElementById('voiceControls').style.display = 'flex';
                document.getElementById('voiceStatus').textContent = 'Microphone ready! Click red button to record';
                
                showToast('Microphone access granted!', 'success');
            } catch (err) {
                console.error('Microphone error:', err);
                document.getElementById('voiceStatus').textContent = 'Microphone access denied. Please check permissions.';
                document.getElementById('micPermissionBtn').disabled = false;
                showToast('Please allow microphone access', 'error');
            }
        }

        // ==================== LOAD DISTRICTS ====================
        function loadDistricts() {
            const districtSelect = document.getElementById('patientDistrict');
            districtSelect.innerHTML = '<option value="">Select District</option>';
            tamilNaduDistricts.forEach(district => {
                const option = document.createElement('option');
                option.value = district;
                option.textContent = district;
                districtSelect.appendChild(option);
            });
        }

        // ==================== SYMPTOM CHECKER ====================
        function loadSymptoms() {
            const grid = document.getElementById('symptomsGrid');
            grid.innerHTML = '';
            
            symptomsDatabase.forEach(symptom => {
                if (currentSymptomCategory === 'all' || symptom.category === currentSymptomCategory) {
                    const item = document.createElement('div');
                    item.className = `symptom-item ${selectedSymptoms.includes(symptom.id) ? 'selected' : ''}`;
                    item.onclick = () => toggleSymptom(symptom.id);
                    
                    item.innerHTML = `
                        <input type="checkbox" ${selectedSymptoms.includes(symptom.id) ? 'checked' : ''}>
                        <span>${symptom.name}</span>
                    `;
                    
                    grid.appendChild(item);
                }
            });
        }

        function filterSymptoms(category) {
            currentSymptomCategory = category;
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            loadSymptoms();
        }

        function toggleSymptom(id) {
            const index = selectedSymptoms.indexOf(id);
            if (index === -1) {
                selectedSymptoms.push(id);
            } else {
                selectedSymptoms.splice(index, 1);
            }
            updateSymptomTags();
            loadSymptoms();
        }

        function updateSymptomTags() {
            const container = document.getElementById('symptomTags');
            
            if (selectedSymptoms.length === 0) {
                container.innerHTML = '<p style="color: var(--gray);">None selected</p>';
                return;
            }
            
            container.innerHTML = '';
            selectedSymptoms.forEach(id => {
                const symptom = symptomsDatabase.find(s => s.id === id);
                if (symptom) {
                    const tag = document.createElement('span');
                    tag.className = 'symptom-tag';
                    tag.innerHTML = `${symptom.name} <button onclick="removeSymptom(${id})">√ó</button>`;
                    container.appendChild(tag);
                }
            });
        }

        function removeSymptom(id) {
            const index = selectedSymptoms.indexOf(id);
            if (index !== -1) {
                selectedSymptoms.splice(index, 1);
                updateSymptomTags();
                loadSymptoms();
            }
        }

        // ==================== VOICE RECORDING ====================
        async function toggleRecording() {
            if (!microphonePermission) {
                showToast('Please allow microphone access first', 'error');
                return;
            }

            if (!isRecording) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    
                    mediaRecorder.ondataavailable = (event) => {
                        audioChunks.push(event.data);
                    };
                    
                    mediaRecorder.onstop = () => {
                        audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        audioUrl = URL.createObjectURL(audioBlob);
                        document.getElementById('playBtn').disabled = false;
                        document.getElementById('voiceStatus').textContent = 'Recording saved! Click play to listen';
                        
                        stream.getTracks().forEach(track => track.stop());
                    };
                    
                    mediaRecorder.start();
                    isRecording = true;
                    
                    document.getElementById('recordBtn').classList.add('recording');
                    document.getElementById('recordBtn').textContent = '‚èπÔ∏è';
                    document.getElementById('voiceStatus').textContent = 'Recording...';
                    
                    recordingSeconds = 0;
                    recordingTimer = setInterval(() => {
                        recordingSeconds++;
                        document.getElementById('timer').textContent = formatTime(recordingSeconds);
                    }, 1000);
                    
                } catch (err) {
                    console.error('Recording error:', err);
                    document.getElementById('voiceStatus').textContent = 'Recording failed';
                    showToast('Recording failed', 'error');
                }
            } else {
                if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                    mediaRecorder.stop();
                }
                clearInterval(recordingTimer);
                isRecording = false;
                document.getElementById('recordBtn').classList.remove('recording');
                document.getElementById('recordBtn').textContent = '‚è∫Ô∏è';
            }
        }

        function playRecording() {
            if (audioUrl) {
                const audio = new Audio(audioUrl);
                audio.play();
                document.getElementById('voiceStatus').textContent = 'Playing...';
                audio.onended = () => {
                    document.getElementById('voiceStatus').textContent = 'Ready';
                };
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // ==================== AI DIAGNOSIS ====================
        function validateForm() {
            const patientName = document.getElementById('patientName').value;
            const patientAge = document.getElementById('patientAge').value;
            const patientDistrict = document.getElementById('patientDistrict').value;
            return patientName && patientAge && patientDistrict && selectedSymptoms.length > 0;
        }

        function analyzeHealth() {
            if (!validateForm()) {
                showToast('Please fill patient details and select symptoms', 'error');
                return;
            }
            
            document.getElementById('analyzeBtn').disabled = true;
            document.getElementById('analyzeBtn').textContent = '‚è≥ Analyzing...';
            
            setTimeout(() => {
                const diagnosis = performAIDiagnosis();
                displayDiagnosisWithDoctorAdvice(diagnosis);
                saveDiagnosis(diagnosis);
                
                document.getElementById('analyzeBtn').disabled = false;
                document.getElementById('analyzeBtn').innerHTML = 'üî¨ Analyze Health Status';
            }, 1500);
        }

        function performAIDiagnosis() {
            const matches = diseaseDatabase.map(disease => {
                const exactMatches = disease.symptoms.filter(s => selectedSymptoms.includes(s));
                const matchPercentage = disease.symptoms.length > 0 
                    ? Math.round((exactMatches.length / disease.symptoms.length) * 100) 
                    : 0;
                
                return { 
                    ...disease, 
                    matchPercentage: matchPercentage,
                    exactMatches: exactMatches.length,
                    totalDiseaseSymptoms: disease.symptoms.length
                };
            }).filter(d => d.matchPercentage > 20)
              .sort((a, b) => b.matchPercentage - a.matchPercentage);
            
            if (matches.length > 0) {
                return matches[0];
            }
            
            return {
                name: 'Unable to Determine',
                severity: 'low',
                description: 'Please consult a doctor for proper diagnosis',
                recommendations: ['Consult a healthcare provider', 'Monitor your symptoms'],
                riskFactors: ['Symptoms unclear'],
                prevention: ['Regular health checkups'],
                medicines: [],
                homeRemedies: ['Rest', 'Hydration'],
                consultDoctor: true,
                warningSigns: ['Symptoms persist']
            };
        }

        function displayDiagnosisWithDoctorAdvice(diagnosis) {
            const resultsDiv = document.getElementById('results');
            const severityClass = diagnosis.severity === 'low' ? 'severity-low' : 
                                diagnosis.severity === 'medium' ? 'severity-medium' : 'severity-high';
            
            const patientName = document.getElementById('patientName').value;
            const patientAge = document.getElementById('patientAge').value;
            const patientGender = document.getElementById('patientGender').options[document.getElementById('patientGender').selectedIndex].text;
            const patientDistrict = document.getElementById('patientDistrict').value;
            
            const matchingSymptomNames = diagnosis.symptoms ? 
                diagnosis.symptoms.filter(id => selectedSymptoms.includes(id))
                    .map(id => symptomsDatabase.find(s => s.id === id)?.name).filter(name => name) : [];
            
            let html = `
                <div class="print-header">
                    <h1>üè• RuralCare AI Medical Report</h1>
                    <p>Generated on: ${new Date().toLocaleString()}</p>
                </div>
                
                <div class="patient-details-print">
                    <p><strong>Name:</strong> ${patientName}</p>
                    <p><strong>Age:</strong> ${patientAge}</p>
                    <p><strong>Gender:</strong> ${patientGender}</p>
                    <p><strong>District:</strong> ${patientDistrict}</p>
                </div>
                
                <div class="diagnosis-header">
                    <div class="diagnosis-icon">ü©∫</div>
                    <div class="diagnosis-info">
                        <h2>${diagnosis.name}</h2>
                        <span class="severity-badge ${severityClass}">${diagnosis.severity.toUpperCase()}</span>
                        <p style="margin-top: 8px;">${diagnosis.description}</p>
                    </div>
                </div>
            `;
            
            if (diagnosis.matchPercentage > 0) {
                html += `
                    <div class="disease-info">
                        <p><strong>Match Confidence:</strong> ${diagnosis.matchPercentage}% (${diagnosis.exactMatches} of ${diagnosis.totalDiseaseSymptoms} symptoms match)</p>
                    </div>
                `;
            }
            
            if (matchingSymptomNames.length > 0) {
                html += `
                    <div class="disease-info">
                        <h3>‚úÖ Matching Symptoms</h3>
                        <div class="symptom-match">
                            ${matchingSymptomNames.map(name => `<span class="match-tag match-high">${name}</span>`).join('')}
                        </div>
                    </div>
                `;
            }
            
            // Doctor Advice Section
            const diagnosisId = Date.now();
            html += `
                <div class="doctor-advice-section" id="doctorAdvice-${diagnosisId}">
                    <div class="doctor-advice-header">
                        <span class="doctor-icon">üë®‚Äç‚öïÔ∏è</span>
                        <h3>Doctor's Advice</h3>
                    </div>
                    
                    <div class="doctor-message" id="doctorMessage-${diagnosisId}">
                        ${getDefaultDoctorAdvice(diagnosis)}
                    </div>
                    
                    <div class="doctor-advice-input">
                        <textarea id="adviceInput-${diagnosisId}" placeholder="Doctor can add specific advice here..." rows="3">${getDefaultDoctorAdvice(diagnosis)}</textarea>
                        <div class="doctor-advice-actions">
                            <button class="btn btn-primary" onclick="updateDoctorAdvice(${diagnosisId})">üíæ Save Advice</button>
                            <button class="btn btn-secondary" onclick="resetDoctorAdvice(${diagnosisId}, '${diagnosis.severity}')">‚Ü∫ Reset</button>
                        </div>
                    </div>
                </div>
            `;
            
            if (diagnosis.consultDoctor || diagnosis.severity === 'high') {
                html += `
                    <div class="recommendation-box consult-doctor">
                        <h3>‚ö†Ô∏è CONSULT DOCTOR IMMEDIATELY</h3>
                        <p>Based on your symptoms and severity, please consult a doctor immediately.</p>
                `;
                
                if (diagnosis.warningSigns && diagnosis.warningSigns.length > 0) {
                    html += `
                        <div class="warning-signs">
                            <strong>Warning Signs:</strong>
                            <ul style="margin-top: 5px;">
                                ${diagnosis.warningSigns.map(sign => `<li>${sign}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                html += `</div>`;
            } else {
                html += `
                    <div class="recommendation-box">
                        <h3>üè† Home Remedies</h3>
                        <ul>
                            ${diagnosis.homeRemedies ? diagnosis.homeRemedies.map(r => `<li>${r}</li>`).join('') : '<li>Rest and stay hydrated</li>'}
                        </ul>
                    </div>
                `;
            }
            
            if (diagnosis.medicines && diagnosis.medicines.length > 0) {
                html += `
                    <div class="disease-info">
                        <h3>üíä Recommended Medicines</h3>
                        <div class="medicine-list">
                            ${diagnosis.medicines.map(med => `
                                <div class="medicine-item">
                                    <strong>${med.name}</strong>
                                    <span>${med.dosage}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            html += `
                <div class="disease-info">
                    <h3>üìã Recommendations</h3>
                    <ul>${diagnosis.recommendations.map(r => `<li>${r}</li>`).join('')}</ul>
                </div>
                
                <div class="result-actions">
                    <button class="btn btn-secondary" onclick="saveToLocal()">üíæ Save</button>
                    <button class="btn btn-warning" onclick="window.print()">üñ®Ô∏è Print Report</button>
                    <button class="btn btn-success" onclick="newDiagnosis()">‚ûï New</button>
                </div>
                
                <p style="text-align: center; margin-top: 15px; font-size: 0.85rem; color: var(--danger);">
                    ‚öïÔ∏è Show this report to your doctor
                </p>
            `;
            
            resultsDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function getDefaultDoctorAdvice(diagnosis) {
            if (diagnosis.severity === 'high') {
                return "URGENT: Please visit the nearest hospital immediately. Based on the symptoms, this requires immediate medical attention.";
            } else if (diagnosis.severity === 'medium') {
                return "Schedule an appointment with your doctor within the next 24-48 hours. Monitor your symptoms and rest.";
            } else {
                return "Rest at home and monitor your symptoms. If symptoms worsen or persist beyond 3 days, please consult a doctor.";
            }
        }

        function updateDoctorAdvice(diagnosisId) {
            const adviceInput = document.getElementById(`adviceInput-${diagnosisId}`);
            const doctorMessage = document.getElementById(`doctorMessage-${diagnosisId}`);
            const newAdvice = adviceInput.value;
            
            doctorMessage.textContent = newAdvice;
            showToast('Doctor\'s advice saved!', 'success');
            
            // Save to the current diagnosis
            const currentDiagnosis = {
                id: diagnosisId,
                doctorAdvice: newAdvice,
                timestamp: new Date().toISOString()
            };
            
            const savedAdvice = JSON.parse(localStorage.getItem('doctorAdvice') || '[]');
            savedAdvice.push(currentDiagnosis);
            localStorage.setItem('doctorAdvice', JSON.stringify(savedAdvice));
        }

        function resetDoctorAdvice(diagnosisId, severity) {
            const adviceInput = document.getElementById(`adviceInput-${diagnosisId}`);
            const doctorMessage = document.getElementById(`doctorMessage-${diagnosisId}`);
            const defaultAdvice = severity === 'high' ? 
                "URGENT: Please visit the nearest hospital immediately. Based on the symptoms, this requires immediate medical attention." :
                severity === 'medium' ?
                "Schedule an appointment with your doctor within the next 24-48 hours. Monitor your symptoms and rest." :
                "Rest at home and monitor your symptoms. If symptoms worsen or persist beyond 3 days, please consult a doctor.";
            
            adviceInput.value = defaultAdvice;
            doctorMessage.textContent = defaultAdvice;
            showToast('Reset to default advice', 'success');
        }

        function saveDiagnosis(diagnosis) {
            const newDiagnosis = {
                id: Date.now(),
                patientName: document.getElementById('patientName').value,
                district: document.getElementById('patientDistrict').value,
                diagnosis: diagnosis.name,
                severity: diagnosis.severity,
                doctorAdvice: getDefaultDoctorAdvice(diagnosis),
                date: new Date().toISOString()
            };
            
            diagnoses.unshift(newDiagnosis);
            if (diagnoses.length > 20) diagnoses.pop();
            localStorage.setItem('diagnoses', JSON.stringify(diagnoses));
            
            updateStats();
            displayDiagnoses();
        }

        // ==================== ENHANCED DISEASE LIBRARY FUNCTIONS ====================
        function loadDiseaseLibrary() {
            const grid = document.getElementById('diseaseGrid');
            displayDiseases(diseaseDatabase);
        }

        function displayDiseases(diseases) {
            const grid = document.getElementById('diseaseGrid');
            grid.innerHTML = '';
            
            diseases.forEach(disease => {
                const card = document.createElement('div');
                card.className = 'disease-card';
                
                // Get first 3 symptom names for preview
                const previewSymptoms = disease.symptoms.slice(0, 3).map(id => {
                    const symptom = symptomsDatabase.find(s => s.id === id);
                    return symptom ? symptom.name : '';
                }).filter(name => name);
                
                const severityClass = disease.severity === 'low' ? 'severity-low' : 
                                    disease.severity === 'medium' ? 'severity-medium' : 'severity-high';
                
                card.innerHTML = `
                    <h3>
                        ${disease.name}
                        <span class="disease-category">${disease.category}</span>
                    </h3>
                    <span class="severity-badge ${severityClass}">${disease.severity.toUpperCase()}</span>
                    <p style="margin: 8px 0;">${disease.description}</p>
                    <div class="disease-preview">
                        ${previewSymptoms.map(s => `<span class="preview-symptom">${s}</span>`).join('')}
                        ${disease.symptoms.length > 3 ? '<span class="preview-symptom">...</span>' : ''}
                    </div>
                    <button class="read-more-btn" onclick="toggleDiseaseDetails(${disease.id})">Read More</button>
                    <div class="disease-full-details" id="details-${disease.id}">
                        <div class="detail-section">
                            <h4>üìã About</h4>
                            <p>${disease.about || disease.description}</p>
                        </div>
                        <div class="detail-section">
                            <h4>ü¶† Causes</h4>
                            <ul>${disease.causes ? disease.causes.map(c => `<li>${c}</li>`).join('') : '<li>Various factors</li>'}</ul>
                        </div>
                        <div class="detail-section">
                            <h4>‚ö†Ô∏è Risk Factors</h4>
                            <ul>${disease.riskFactors ? disease.riskFactors.map(r => `<li>${r}</li>`).join('') : '<li>General population</li>'}</ul>
                        </div>
                        <div class="detail-section">
                            <h4>üö® Complications</h4>
                            <ul>${disease.complications ? disease.complications.map(c => `<li>${c}</li>`).join('') : '<li>Varies by individual</li>'}</ul>
                        </div>
                        <div class="detail-section">
                            <h4>üõ°Ô∏è Prevention</h4>
                            <ul>${disease.prevention ? disease.prevention.map(p => `<li>${p}</li>`).join('') : '<li>Consult doctor</li>'}</ul>
                        </div>
                        <div class="detail-section">
                            <h4>üíä Treatments</h4>
                            <div class="medicine-list">
                                ${disease.medicines ? disease.medicines.map(med => `
                                    <div class="medicine-item">
                                        <strong>${med.name}</strong>
                                        <span>${med.dosage}</span>
                                    </div>
                                `).join('') : '<p>Consult doctor for treatment</p>'}
                            </div>
                        </div>
                        <div class="detail-section">
                            <h4>üè† Home Remedies</h4>
                            <ul>${disease.homeRemedies ? disease.homeRemedies.map(r => `<li>${r}</li>`).join('') : '<li>Rest and hydration</li>'}</ul>
                        </div>
                        <div class="detail-section">
                            <h4>‚ö†Ô∏è Warning Signs</h4>
                            <ul>${disease.warningSigns ? disease.warningSigns.map(w => `<li>${w}</li>`).join('') : '<li>Seek medical help if symptoms worsen</li>'}</ul>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
            
            // Update total diseases count
            document.getElementById('totalDiseases').innerHTML = `${diseaseDatabase.length} Diseases`;
        }

        function toggleDiseaseDetails(id) {
            const detailsDiv = document.getElementById(`details-${id}`);
            const button = event.target;
            
            if (detailsDiv.classList.contains('show')) {
                detailsDiv.classList.remove('show');
                button.textContent = 'Read More';
            } else {
                detailsDiv.classList.add('show');
                button.textContent = 'Read Less';
            }
        }

        function filterDiseasesByCategory(category) {
            currentDiseaseCategory = category;
            
            // Update active button
            document.querySelectorAll('.category-filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Filter diseases
            const filtered = category === 'all' 
                ? diseaseDatabase 
                : diseaseDatabase.filter(d => d.category === category);
            
            displayDiseases(filtered);
        }

        function searchDiseases() {
            const searchTerm = document.getElementById('diseaseSearch').value.toLowerCase();
            
            const filtered = diseaseDatabase.filter(d => 
                d.name.toLowerCase().includes(searchTerm) || 
                d.description.toLowerCase().includes(searchTerm) ||
                (d.causes && d.causes.some(c => c.toLowerCase().includes(searchTerm))) ||
                d.symptoms.some(id => {
                    const symptom = symptomsDatabase.find(s => s.id === id);
                    return symptom && symptom.name.toLowerCase().includes(searchTerm);
                })
            );
            
            displayDiseases(filtered);
        }

        // ==================== UI FUNCTIONS ====================
        function updateStats() {
            document.getElementById('totalDiagnoses').textContent = diagnoses.length;
            
            const today = new Date().toDateString();
            document.getElementById('todayDiagnoses').textContent = 
                diagnoses.filter(d => new Date(d.date).toDateString() === today).length;
            
            document.getElementById('highRisk').textContent = 
                diagnoses.filter(d => d.severity === 'high').length;
        }

        function displayDiagnoses() {
            const tbody = document.getElementById('tableBody');
            const recent = diagnoses.slice(0, 10);
            
            if (recent.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No diagnoses yet</td></tr>';
                return;
            }
            
            tbody.innerHTML = recent.map(d => {
                const date = new Date(d.date).toLocaleString();
                const severityClass = d.severity;
                const advicePreview = d.doctorAdvice ? d.doctorAdvice.substring(0, 30) + '...' : 'No advice yet';
                
                return `
                    <tr>
                        <td>${date}</td>
                        <td>${d.patientName}</td>
                        <td>${d.district || 'N/A'}</td>
                        <td>${d.diagnosis}</td>
                        <td><span class="status-badge ${severityClass}">${d.severity.toUpperCase()}</span></td>
                        <td>${advicePreview}</td>
                        <td><button class="action-btn" onclick="viewDiagnosis(${d.id})">View</button></td>
                    </tr>
                `;
            }).join('');
        }

        function viewDiagnosis(id) {
            const d = diagnoses.find(d => d.id === id);
            if (d) {
                alert(`Patient: ${d.patientName}\nDistrict: ${d.district}\nDiagnosis: ${d.diagnosis}\nSeverity: ${d.severity}\nDoctor Advice: ${d.doctorAdvice || 'Not available'}\nDate: ${new Date(d.date).toLocaleString()}`);
            }
        }

        function newDiagnosis() {
            selectedSymptoms = [];
            updateSymptomTags();
            loadSymptoms();
            
            document.getElementById('patientName').value = '';
            document.getElementById('patientAge').value = '';
            document.getElementById('patientGender').value = 'male';
            document.getElementById('patientDistrict').value = '';
            document.getElementById('symptomsText').value = '';
            
            audioBlob = null; 
            audioUrl = null; 
            recordingSeconds = 0;
            document.getElementById('timer').textContent = '00:00';
            document.getElementById('playBtn').disabled = true;
            document.getElementById('voiceStatus').textContent = 'Ready';
            
            document.getElementById('results').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function saveToLocal() { 
            showToast('Report saved to local storage'); 
        }
        
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        function switchLanguage(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`lang${lang.charAt(0).toUpperCase() + lang.slice(1)}`).classList.add('active');
            showToast('Language switched to ' + lang.toUpperCase(), 'success');
        }

        // Make functions global
        window.handleLogin = handleLogin;
        window.handleLogout = handleLogout;
        window.switchLanguage = switchLanguage;
        window.requestMicrophonePermission = requestMicrophonePermission;
        window.filterSymptoms = filterSymptoms;
        window.toggleSymptom = toggleSymptom;
        window.removeSymptom = removeSymptom;
        window.toggleRecording = toggleRecording;
        window.playRecording = playRecording;
        window.analyzeHealth = analyzeHealth;
        window.searchDiseases = searchDiseases;
        window.saveToLocal = saveToLocal;
        window.newDiagnosis = newDiagnosis;
        window.viewDiagnosis = viewDiagnosis;
        window.updateDoctorAdvice = updateDoctorAdvice;
        window.resetDoctorAdvice = resetDoctorAdvice;
        window.filterDiseasesByCategory = filterDiseasesByCategory;
        window.toggleDiseaseDetails = toggleDiseaseDetails;
    </script>
</body>
</html>
