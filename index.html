<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RuralCare AI - Offline Health Screening</title>

<style>
/* ===== SAME DESIGN (unchanged structure, cleaned) ===== */

*{margin:0;padding:0;box-sizing:border-box}
body{
font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto;
background:#f5f5f6;color:#263238;line-height:1.6;padding:20px
}

.container{max-width:1400px;margin:0 auto}

.header{
background:linear-gradient(135deg,#1b5e20,#0a3d0a);
color:white;padding:20px;border-radius:16px;margin-bottom:30px;
display:flex;justify-content:space-between;align-items:center
}

.section{
background:white;border-radius:16px;padding:25px;
margin-bottom:30px;box-shadow:0 4px 6px rgba(0,0,0,0.1)
}

.form-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
gap:20px
}

.form-group{display:flex;flex-direction:column}

.form-group input,.form-group select{
padding:10px;border:2px solid #e0e0e0;border-radius:8px
}

.btn{
padding:12px 20px;border:none;border-radius:8px;
cursor:pointer;font-weight:bold
}

.btn-primary{background:#1b5e20;color:white}
.btn-success{background:#2e7d32;color:white}
.btn-secondary{background:white;border:2px solid #1b5e20;color:#1b5e20}

table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #ddd}
.status-healthy{color:#2e7d32;font-weight:bold}
.status-followup{color:#ef6c00;font-weight:bold}

.preview-image{width:100%;max-width:500px;border-radius:12px}

.loading{text-align:center;margin:20px}

</style>
</head>

<body>

<div class="container">

<header class="header">
<h1>üè• RuralCare AI</h1>
<div>
Today: <span id="todayCount">0</span> |
Pending: <span id="pendingSync">0</span>
</div>
</header>

<!-- ================= PATIENT FORM ================= -->
<section class="section">
<h2>üìã Patient Information</h2>

<div class="form-grid">
<div class="form-group">
<label>Patient ID *</label>
<input type="text" id="patientId">
</div>

<div class="form-group">
<label>Full Name *</label>
<input type="text" id="patientName">
</div>

<div class="form-group">
<label>Age *</label>
<input type="number" id="patientAge" min="0" max="120">
</div>

<div class="form-group">
<label>Gender</label>
<select id="patientGender">
<option value="male">Male</option>
<option value="female">Female</option>
<option value="other">Other</option>
</select>
</div>

<div class="form-group">
<label>Village *</label>
<input type="text" id="villageName">
</div>

<div class="form-group">
<label>Contact</label>
<input type="tel" id="contactNumber">
</div>
</div>
</section>

<!-- ================= IMAGE SECTION ================= -->
<section class="section">
<h2>üì∏ Patient Photo</h2>

<input type="file" id="imageUpload" accept="image/*">
<br><br>
<img id="preview" class="preview-image" style="display:none">
</section>

<button class="btn btn-primary" id="analyzeBtn" onclick="analyzeHealth()" disabled>
üî¨ Analyze Health Status
</button>

<div class="loading" id="loading" style="display:none">Analyzing...</div>

<!-- ================= RESULTS ================= -->
<section class="section" id="results" style="display:none">
<h2>üßæ Screening Report</h2>
<p><strong>Status:</strong> <span id="statusText"></span></p>
<p><strong>Description:</strong> <span id="statusDescription"></span></p>
<p><strong>Follow-up:</strong> <span id="followUpText"></span></p>
</section>

<!-- ================= SEARCH ================= -->
<section class="section">
<h2>üìä Recent Screenings</h2>

<input type="text" id="searchBox" placeholder="Search by ID or Name" oninput="searchScreenings()">
<br><br>

<table>
<thead>
<tr>
<th>Time</th>
<th>ID</th>
<th>Name</th>
<th>Age</th>
<th>Status</th>
<th>Follow-up</th>
</tr>
</thead>
<tbody id="tableBody">
<tr><td colspan="6" align="center">No screenings yet</td></tr>
</tbody>
</table>
</section>

<button class="btn btn-secondary" onclick="exportData()">üì§ Export CSV</button>
<button class="btn btn-secondary" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>

</div>

<script>

/* ================= STATE ================= */

let capturedImage=null;
let screenings=JSON.parse(localStorage.getItem("screenings")||"[]");
let offlineQueue=JSON.parse(localStorage.getItem("offlineQueue")||"[]");

/* ================= INIT ================= */

document.addEventListener("DOMContentLoaded",()=>{
updateStats();
displayScreenings();
});

/* ================= IMAGE UPLOAD ================= */

document.getElementById("imageUpload").addEventListener("change",function(e){
const file=e.target.files[0];
if(!file)return;

if(file.size>3*1024*1024){
alert("Image must be below 3MB");
return;
}

const reader=new FileReader();
reader.onload=function(ev){
capturedImage=ev.target.result;
document.getElementById("preview").src=capturedImage;
document.getElementById("preview").style.display="block";
validateForm();
};
reader.readAsDataURL(file);
});

/* ================= VALIDATION ================= */

function validateForm(){
const id=document.getElementById("patientId").value.trim();
const name=document.getElementById("patientName").value.trim();
const age=parseInt(document.getElementById("patientAge").value);
const village=document.getElementById("villageName").value.trim();

if(!id||!name||!age||!village||!capturedImage){
document.getElementById("analyzeBtn").disabled=true;
return false;
}

if(age<0||age>120){
alert("Invalid age");
document.getElementById("analyzeBtn").disabled=true;
return false;
}

if(screenings.some(s=>s.patientId===id)){
alert("Duplicate Patient ID");
document.getElementById("analyzeBtn").disabled=true;
return false;
}

document.getElementById("analyzeBtn").disabled=false;
return true;
}

/* ================= AI LOGIC ================= */

function analyzeHealth(){

if(!validateForm())return;

document.getElementById("loading").style.display="block";

setTimeout(()=>{

const age=parseInt(document.getElementById("patientAge").value);
let requiresFollowUp=false;
let description="";
let recommendations="";

if(age>65){
requiresFollowUp=true;
description="Senior citizen detected. Preventive medical check recommended.";
recommendations="Visit PHC within 7 days.";
}
else if(age<5){
requiresFollowUp=true;
description="Child below 5 years. Pediatric consultation advised.";
recommendations="Consult child specialist.";
}
else{
description="No immediate health concerns detected.";
recommendations="Continue healthy lifestyle.";
}

const result={
id:Date.now(),
timestamp:new Date().toISOString(),
patientId:document.getElementById("patientId").value,
patientName:document.getElementById("patientName").value,
patientAge:age,
status:requiresFollowUp?"Needs Follow-up":"Healthy",
requiresFollowUp:requiresFollowUp,
description:description,
followUp:recommendations
};

screenings.unshift(result);
screenings=screenings.slice(0,100);
localStorage.setItem("screenings",JSON.stringify(screenings));

displayResults(result);
updateStats();
displayScreenings();

document.getElementById("loading").style.display="none";

},1500);
}

/* ================= DISPLAY ================= */

function displayResults(result){
document.getElementById("results").style.display="block";
document.getElementById("statusText").innerText=result.status;
document.getElementById("statusDescription").innerText=result.description;
document.getElementById("followUpText").innerText=result.followUp;
}

/* ================= TABLE ================= */

function displayScreenings(data=screenings){
const tbody=document.getElementById("tableBody");

if(data.length===0){
tbody.innerHTML='<tr><td colspan="6" align="center">No screenings yet</td></tr>';
return;
}

tbody.innerHTML=data.map(s=>`
<tr>
<td>${new Date(s.timestamp).toLocaleString()}</td>
<td>${s.patientId}</td>
<td>${s.patientName}</td>
<td>${s.patientAge}</td>
<td class="${s.requiresFollowUp?'status-followup':'status-healthy'}">${s.status}</td>
<td>${s.requiresFollowUp?'Yes':'No'}</td>
</tr>
`).join("");
}

/* ================= SEARCH ================= */

function searchScreenings(){
const q=document.getElementById("searchBox").value.toLowerCase();
const filtered=screenings.filter(s=>
s.patientId.toLowerCase().includes(q)||
s.patientName.toLowerCase().includes(q)
);
displayScreenings(filtered);
}

/* ================= EXPORT ================= */

function exportData(){
if(screenings.length===0){alert("No data");return;}

let csv="Time,ID,Name,Age,Status,FollowUp\n";
screenings.forEach(s=>{
csv+=`${new Date(s.timestamp).toLocaleString()},${s.patientId},${s.patientName},${s.patientAge},${s.status},${s.requiresFollowUp}\n`;
});

const blob=new Blob([csv],{type:"text/csv"});
const url=URL.createObjectURL(blob);
const a=document.createElement("a");
a.href=url;
a.download="ruralcare_export.csv";
a.click();
}

/* ================= CLEAR ================= */

function clearAllData(){
if(confirm("Delete all data?")){
screenings=[];
localStorage.removeItem("screenings");
displayScreenings();
updateStats();
}
}

/* ================= STATS ================= */

function updateStats(){
const today=new Date().toDateString();
const todayCount=screenings.filter(s=>
new Date(s.timestamp).toDateString()===today
).length;

document.getElementById("todayCount").innerText=todayCount;
document.getElementById("pendingSync").innerText=offlineQueue.length;
}

</script>

</body>
</html>
