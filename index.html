<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RuralCare AI - Complete Symptom Analyzer</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Segoe UI,Arial;background:#f5f5f6;padding:20px;color:#263238}
.container{max-width:1400px;margin:auto}
.section{background:#fff;padding:25px;border-radius:14px;margin-bottom:25px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
h2{color:#1b5e20;margin-bottom:15px;border-bottom:2px solid #e8f5e9;padding-bottom:10px}
h3{color:#2e7d32;margin:15px 0 10px}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px}
.symptom-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin:15px 0}
input,select,textarea{padding:12px;border:1px solid #ccc;border-radius:8px;width:100%;font-size:14px}
textarea{min-height:80px;resize:vertical}
button{padding:12px 25px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:15px;transition:all 0.3s}
button:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,0.2)}
.btn-primary{background:#1b5e20;color:#fff}
.btn-secondary{background:#eee;color:#333}
.btn-danger{background:#c62828;color:#fff}
.btn-group{display:flex;gap:15px;flex-wrap:wrap;margin:20px 0}
#results{display:none;margin-top:20px}
.status-healthy{color:#2e7d32;font-weight:bold;font-size:18px}
.status-followup{color:#ef6c00;font-weight:bold;font-size:18px}
.status-emergency{color:#c62828;font-weight:bold;font-size:18px}
.progress{height:25px;background:#ddd;border-radius:15px;margin:10px 0;overflow:hidden}
.progress-bar{height:100%;background:#1b5e20;width:0%;transition:width 0.5s}
table{width:100%;border-collapse:collapse;margin-top:15px;background:white;border-radius:10px;overflow:hidden}
th,td{padding:12px;border-bottom:1px solid #e0e0e0;text-align:left}
th{background:#1b5e20;color:white;font-weight:500}
tr:hover{background:#f5f5f5}
.symptom-category{background:#f1f8e9;padding:15px;border-radius:10px;margin-bottom:15px}
.symptom-item{display:flex;align-items:center;gap:8px;padding:8px;background:white;border-radius:6px;border:1px solid #c8e6c9}
.symptom-item input[type="checkbox"]{width:18px;height:18px;cursor:pointer}
.symptom-item label{cursor:pointer;flex:1}
.severity-badge{font-size:11px;padding:2px 6px;border-radius:4px;background:#eee}
.severity-high{background:#ffcdd2;color:#c62828}
.severity-medium{background:#fff3e0;color:#ef6c00}
.severity-low{background:#e8f5e9;color:#2e7d32}
.emergency-box{background:#ffebee;border:2px solid #c62828;padding:20px;border-radius:10px;margin:15px 0}
.emergency-text{color:#c62828;font-weight:bold;font-size:16px}
.filter-buttons{display:flex;gap:10px;margin-bottom:15px;flex-wrap:wrap}
.filter-btn{padding:8px 15px;background:#e0e0e0;border-radius:20px;cursor:pointer}
.filter-btn.active{background:#1b5e20;color:white}
.ai-suggestion{background:#f3e5f5;padding:20px;border-radius:10px;margin:15px 0;border-left:4px solid #7b1fa2}
.ai-badge{background:#7b1fa2;color:white;padding:5px 15px;border-radius:20px;font-size:14px;display:inline-block;margin-bottom:15px}
.possible-condition{background:#fff3e0;padding:15px;border-radius:8px;margin:10px 0;border-left:4px solid #ef6c00}
.condition-name{font-weight:bold;color:#ef6c00;font-size:16px}
.recommendation-item{padding:10px;border-left:4px solid #1b5e20;margin:8px 0;background:white}
.medicine-item{background:#e3f2fd;padding:10px;margin:5px 0;border-radius:6px;border-left:4px solid #1565c0}
.symptom-tag{display:inline-block;background:#e8f5e9;padding:5px 12px;border-radius:20px;margin:3px;font-size:13px;border:1px solid #a5d6a7}
.loader{display:none;text-align:center;padding:20px}
.loader-spinner{border:4px solid #f3f3f3;border-top:4px solid #1b5e20;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin:auto}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
</style>
</head>
<body>
<div class="container">

<!-- Patient Information Section -->
<div class="section">
<h2>üìã Patient Information</h2>
<div class="form-grid">
<input type="text" id="patientName" placeholder="Full Name *" required>
<input type="number" id="patientAge" placeholder="Age *" required>
<select id="patientGender">
<option value="Male">Male</option>
<option value="Female">Female</option>
<option value="Other">Other</option>
</select>
<input type="number" id="height" placeholder="Height (cm)" step="0.1">
<input type="number" id="weight" placeholder="Weight (kg)" step="0.1">
<input type="number" step="0.1" id="temperature" placeholder="Temperature ¬∞C">
<input type="text" id="bp" placeholder="Blood Pressure (e.g., 120/80)">
</div>
</div>

<!-- Symptoms Assessment Section -->
<div class="section">
<h2>ü©∫ AI Symptom Checker</h2>
<p style="margin-bottom:15px;color:#666;">Select your symptoms for AI diagnosis:</p>

<!-- Quick Symptom Search -->
<div style="margin-bottom:20px">
<input type="text" id="symptomSearch" placeholder="üîç Search symptoms..." onkeyup="filterSymptoms()">
</div>

<!-- All Symptoms Categories -->
<div class="symptom-category">
<h3>ü§í General Symptoms</h3>
<div class="symptom-grid">
<div class="symptom-item"><input type="checkbox" id="fever"><label for="fever">Fever / High Temperature</label><span class="severity-badge severity-medium">Medium</span></div>
<div class="symptom-item"><input type="checkbox" id="chills"><label for="chills">Chills / Shivering</label><span class="severity-badge severity-medium">Medium</span></div>
<div class="symptom-item"><input type="checkbox" id="fatigue"><label for="fatigue">Fatigue / Weakness</label><span class="severity-badge severity-low">Low</span></div>
<div class="symptom-item"><input type="checkbox" id="weightLoss"><label for="weightLoss">Unexplained Weight Loss</label><span class="severity-badge severity-high">High</span></div>
<div class="symptom-item"><input type="checkbox" id="lossAppetite"><label for="lossAppetite">Loss of Appetite</label><span class="severity-badge severity-low">Low</span></div>
</div>
</div>

<div class="symptom-category">
<h3>ü´Å Respiratory Symptoms</h3>
<div class="symptom-grid">
<div class="symptom-item"><input type="checkbox" id="cough"><label for="cough">Cough</label><span class="severity-badge severity-low">Low</span></div>
<div class="symptom-item"><input type="checkbox" id="dryCough"><label for="dryCough">Dry Cough</label><span class="severity-badge severity-low">Low</span></div>
<div class="symptom-item"><input type="checkbox" id="wetCough"><label for="wetCough">Wet Cough with Phlegm</label><span class="severity-badge severity-medium">Medium</span></div>
<div class="symptom-item"><input type="checkbox" id="bloodCough"><label for="bloodCough">Coughing Blood</label><span class="severity-badge severity-high">High</span></div>
<div class="symptom-item"><input type="checkbox" id="shortnessBreath"><label for="shortnessBreath">Shortness of Breath</label><span class="severity-badge severity-high">High</span></div>
<div class="symptom-item"><input type="checkbox" id="wheezing"><label for="wheezing">Wheezing</label><span class="severity-badge severity-medium">Medium</span></div>
<div class="symptom-item"><input type="checkbox" id="chestPain"><label for="chestPain">Chest Pain</label><span class="severity-badge severity-high">High</span></div>
<div class="symptom-item"><input type="checkbox" id="soreThroat"><label for="soreThroat">Sore Throat</label><span class="severity-badge severity-low">Low</span></div>
<div class="symptom-item"><input type="checkbox" id="runnyNose"><label for="runnyNose">Runny Nose</label><span class="severity-badge severity-low">Low</span></div>
</div>
</div>

<div class="symptom-category">
<h3>ü´É Gastrointestinal Symptoms</h3>
<div class="symptom-grid">
<div class="symptom-item"><input type="checkbox" id="nausea"><label for="nausea">Nausea</label><span class="severity-badge severity-low">Low</span></div>
<div class="symptom-item"><input type="checkbox" id="vomiting"><label for="vomiting">Vomiting</label><span class="severity-badge severity-medium">Medium</span></div>
<div class="symptom-item"><input type="checkbox" id="diarrhea"><label for="diarrhea">Diarrhea</label><span class="severity-badge severity-medium">Medium</span></div>
<div class="symptom-item"><input type="checkbox" id="bloodStool"><label for="bloodStool">Blood in Stool</label><span class="severity-badge severity-high">High</span></div>
<div class="symptom-item"><input type="checkbox" id="constipation"><label for="constipation">Constipation</label><span class="severity-badge severity-low">Low</span></div>
<div class="symptom-item"><input type="checkbox" id="abdominalPain"><label for="abdominalPain">Abdominal Pain</label><span class="severity-badge severity-medium">Medium</span></div>
<div class="symptom-item"><input type="checkbox" id="heartburn"><label for="heartburn">Heartburn / Acidity</label><span class="severity-badge severity-low">Low</span></div>
</div>
</div>

<div class="symptom-category">
<h3>üß† Neurological Symptoms</h3>
<div class="symptom-grid">
<div class="symptom-item"><input type="checkbox" id="headache"><label for="headache">Headache</label><span class="severity-badge severity-low">Low</span></div>
<div class="symptom-item"><input type="checkbox" id="dizziness"><label for="dizziness">Dizziness</label><span class="severity-badge severity-medium">Medium</span></div>
<div class="symptom-item"><input type="checkbox" id="fainting"><label for="fainting">Fainting</label><span class="severity-badge severity-high">High</span></div>
<div class="symptom-item"><input type="checkbox" id="seizures"><label for="seizures">Seizures</label><span class="severity-badge severity-high">High</span></div>
<div class="symptom-item"><input type="checkbox" id="confusion"><label for="confusion">Confusion</label><span class="severity-badge severity-high">High</span></div>
</div>
</div>

<div class="symptom-category">
<h3>üí™ Musculoskeletal Symptoms</h3>
<div class="symptom-grid">
<div class="symptom-item"><input type="checkbox" id="jointPain"><label for="jointPain">Joint Pain</label><span class="severity-badge severity-low">Low</span></div>
<div class="symptom-item"><input type="checkbox" id="musclePain"><label for="musclePain">Muscle Pain</label><span class="severity-badge severity-low">Low</span></div>
<div class="symptom-item"><input type="checkbox" id="backPain"><label for="backPain">Back Pain</label><span class="severity-badge severity-low">Low</span></div>
</div>
</div>

<div class="symptom-category">
<h3>üî¥ Skin Symptoms</h3>
<div class="symptom-grid">
<div class="symptom-item"><input type="checkbox" id="rash"><label for="rash">Skin Rash</label><span class="severity-badge severity-low">Low</span></div>
<div class="symptom-item"><input type="checkbox" id="itching"><label for="itching">Itching</label><span class="severity-badge severity-low">Low</span></div>
<div class="symptom-item"><input type="checkbox" id="yellowSkin"><label for="yellowSkin">Yellow Skin (Jaundice)</label><span class="severity-badge severity-high">High</span></div>
</div>
</div>

<div class="symptom-category">
<h3>üöΩ Urinary Symptoms</h3>
<div class="symptom-grid">
<div class="symptom-item"><input type="checkbox" id="painUrination"><label for="painUrination">Painful Urination</label><span class="severity-badge severity-medium">Medium</span></div>
<div class="symptom-item"><input type="checkbox" id="bloodUrine"><label for="bloodUrine">Blood in Urine</label><span class="severity-badge severity-high">High</span></div>
</div>
</div>

<!-- Additional Notes -->
<div style="margin-top:20px">
<textarea id="additionalSymptoms" placeholder="Describe any other symptoms..."></textarea>
</div>
</div>

<!-- Action Buttons -->
<div class="btn-group">
<button class="btn-primary" onclick="analyzeHealth()">üî¨ AI Health Analysis</button>
<button class="btn-secondary" onclick="clearForm()">üîÑ Clear Form</button>
<button class="btn-danger" onclick="emergencyOverride()">üö® Emergency</button>
</div>

<!-- Loading Indicator -->
<div id="loader" class="loader">
<div class="loader-spinner"></div>
<p style="margin-top:10px">AI analyzing your symptoms...</p>
</div>

<!-- Results Section -->
<div id="results" class="section">
<h2>üìä AI Diagnosis Report</h2>
<div id="emergencyAlert" style="display:none" class="emergency-box">
<div class="emergency-text">üö® EMERGENCY - Immediate Action Required</div>
<p id="emergencyMessage"></p>
</div>

<!-- AI Diagnosis -->
<div class="ai-suggestion">
<div class="ai-badge">ü§ñ AI DIAGNOSIS</div>
<div id="diagnosisContent"></div>
</div>

<p id="statusText"></p>
<p id="description"></p>

<div>
<h3>Analysis Confidence</h3>
<div class="progress"><div id="confidenceBar" class="progress-bar"></div></div>
<p id="confidenceText"></p>
</div>

<div style="margin:15px 0;padding:15px;background:#f5f5f5;border-radius:8px">
<h3>üìã Your Symptoms:</h3>
<div id="symptomList"></div>
</div>

<div style="margin:20px 0">
<h3>üí° Recommended Solutions:</h3>
<div id="solutionsList"></div>
</div>

<div style="margin:20px 0;padding:15px;background:#e3f2fd;border-radius:8px">
<h3>üíä Suggested Medicines:</h3>
<div id="medicinesList"></div>
<p style="font-size:12px;color:#666;margin-top:10px;">‚ö†Ô∏è Always consult a doctor before taking any medicine</p>
</div>

<div id="followUp"></div>
</div>

<!-- History Section -->
<div class="section">
<h2>üìú Recent Consultations</h2>
<table>
<thead>
<tr><th>Time</th><th>Name</th><th>Age</th><th>Diagnosis</th><th>Status</th></tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

</div>

<script>
// Global variables
let screenings = JSON.parse(localStorage.getItem("screenings") || "[]");

// Initial render
renderTable();

// Symptom search filter
function filterSymptoms() {
    let searchText = document.getElementById('symptomSearch').value.toLowerCase();
    let symptomItems = document.querySelectorAll('.symptom-item');
    
    symptomItems.forEach(item => {
        let label = item.querySelector('label').textContent.toLowerCase();
        if (label.includes(searchText) || searchText === '') {
            item.style.display = 'flex';
        } else {
            item.style.display = 'none';
        }
    });
}

// Clear form function - FIXED
function clearForm() {
    document.getElementById('patientName').value = '';
    document.getElementById('patientAge').value = '';
    document.getElementById('patientGender').value = 'Male';
    document.getElementById('height').value = '';
    document.getElementById('weight').value = '';
    document.getElementById('temperature').value = '';
    document.getElementById('bp').value = '';
    document.getElementById('additionalSymptoms').value = '';
    document.getElementById('symptomSearch').value = '';
    
    // Uncheck all checkboxes
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach(cb => cb.checked = false);
    
    // Hide results
    document.getElementById('results').style.display = 'none';
    
    // Hide emergency alert if visible
    document.getElementById('emergencyAlert').style.display = 'none';
    
    // Show all symptoms again
    filterSymptoms();
    
    console.log("Form cleared successfully");
}

// Emergency override - FIXED
function emergencyOverride() {
    const name = document.getElementById("patientName").value.trim();
    const age = document.getElementById("patientAge").value;
    
    if (!name || !age) {
        alert("‚ö†Ô∏è Please fill Patient Name and Age first");
        return;
    }
    
    // Show loader
    document.getElementById('loader').style.display = 'block';
    document.getElementById('results').style.display = 'none';
    document.getElementById('emergencyAlert').style.display = 'none';
    
    setTimeout(() => {
        document.getElementById('loader').style.display = 'none';
        
        const emergencyResult = {
            status: "emergency",
            statusText: "üö® EMERGENCY",
            diagnosis: "MEDICAL EMERGENCY",
            description: "‚ö†Ô∏è EMERGENCY OVERRIDE ACTIVATED - Patient requires immediate medical attention!",
            confidence: 99,
            solutions: [
                "üöë CALL AMBULANCE IMMEDIATELY - DIAL 108 OR 102",
                "üè• RUSH TO NEAREST HOSPITAL WITHOUT DELAY",
                "üõå Keep patient in comfortable position",
                "üí¨ Monitor breathing and consciousness",
                "üìû Contact emergency contact",
                "üö´ Do NOT give food or water if unconscious"
            ],
            medicines: ["üö® EMERGENCY - NO SELF MEDICATION"],
            symptoms: "Emergency override activated",
            followUp: "URGENT: Immediate emergency care required"
        };
        
        displayResults(emergencyResult);
        saveScreening(name, age, emergencyResult);
    }, 1000);
}

// Get selected symptoms - FIXED
function getSelectedSymptoms() {
    const symptoms = [];
    const symptomMap = {
        'fever': 'Fever',
        'chills': 'Chills',
        'fatigue': 'Fatigue',
        'weightLoss': 'Weight Loss',
        'lossAppetite': 'Loss of Appetite',
        'cough': 'Cough',
        'dryCough': 'Dry Cough',
        'wetCough': 'Wet Cough',
        'bloodCough': 'Coughing Blood',
        'shortnessBreath': 'Shortness of Breath',
        'wheezing': 'Wheezing',
        'chestPain': 'Chest Pain',
        'soreThroat': 'Sore Throat',
        'runnyNose': 'Runny Nose',
        'nausea': 'Nausea',
        'vomiting': 'Vomiting',
        'diarrhea': 'Diarrhea',
        'bloodStool': 'Blood in Stool',
        'constipation': 'Constipation',
        'abdominalPain': 'Abdominal Pain',
        'heartburn': 'Heartburn',
        'headache': 'Headache',
        'dizziness': 'Dizziness',
        'fainting': 'Fainting',
        'seizures': 'Seizures',
        'confusion': 'Confusion',
        'jointPain': 'Joint Pain',
        'musclePain': 'Muscle Pain',
        'backPain': 'Back Pain',
        'rash': 'Rash',
        'itching': 'Itching',
        'yellowSkin': 'Yellow Skin',
        'painUrination': 'Painful Urination',
        'bloodUrine': 'Blood in Urine'
    };
    
    for (let [id, label] of Object.entries(symptomMap)) {
        let element = document.getElementById(id);
        if (element && element.checked) {
            symptoms.push(label);
        }
    }
    
    return symptoms;
}

// AI Diagnosis Engine - FIXED
function getAIDiagnosis(symptoms, age, temp, bp) {
    let diagnosis = [];
    let solutions = [];
    let medicines = [];
    let emergency = false;
    let emergencyMsg = "";
    
    // EMERGENCY CHECKS
    if (symptoms.includes('Chest Pain')) {
        emergency = true;
        emergencyMsg = "‚ö†Ô∏è CHEST PAIN - Possible heart attack. SEEK EMERGENCY CARE IMMEDIATELY!";
    }
    else if (symptoms.includes('Shortness of Breath') && symptoms.includes('Chest Pain')) {
        emergency = true;
        emergencyMsg = "‚ö†Ô∏è CHEST PAIN with BREATHING DIFFICULTY - Cardiac emergency!";
    }
    else if (symptoms.includes('Coughing Blood')) {
        emergency = true;
        emergencyMsg = "‚ö†Ô∏è COUGHING BLOOD - Possible TB or internal bleeding. Immediate medical attention required!";
    }
    else if (symptoms.includes('Blood in Stool')) {
        emergency = true;
        emergencyMsg = "‚ö†Ô∏è BLOOD IN STOOL - Possible internal bleeding. Seek immediate care!";
    }
    else if (symptoms.includes('Blood in Urine')) {
        emergency = true;
        emergencyMsg = "‚ö†Ô∏è BLOOD IN URINE - Kidney or bladder issue. Immediate medical attention required!";
    }
    else if (symptoms.includes('Fainting')) {
        emergency = true;
        emergencyMsg = "‚ö†Ô∏è FAINTING - Loss of consciousness. Neurological emergency!";
    }
    else if (symptoms.includes('Seizures')) {
        emergency = true;
        emergencyMsg = "‚ö†Ô∏è SEIZURES - Neurological emergency. Immediate medical attention!";
    }
    else if (symptoms.includes('Confusion')) {
        emergency = true;
        emergencyMsg = "‚ö†Ô∏è CONFUSION - Possible stroke or severe infection. Seek immediate care!";
    }
    else if (symptoms.includes('Yellow Skin')) {
        emergency = true;
        emergencyMsg = "‚ö†Ô∏è YELLOW SKIN - Jaundice. Liver condition needs immediate attention!";
    }
    
    // BP Emergency
    if (bp) {
        let bpParts = bp.split('/');
        if (bpParts.length === 2) {
            let systolic = parseInt(bpParts[0]);
            if (systolic >= 180) {
                emergency = true;
                emergencyMsg = "‚ö†Ô∏è CRITICALLY HIGH BLOOD PRESSURE - Hypertensive emergency!";
            }
        }
    }
    
    // Fever emergency
    if (temp > 39.5 && (symptoms.includes('Seizures') || symptoms.includes('Confusion'))) {
        emergency = true;
        emergencyMsg = "‚ö†Ô∏è VERY HIGH FEVER with neurological symptoms - Possible severe infection!";
    }
    
    // Age emergency
    if (age < 5 && (symptoms.includes('Fever') || symptoms.includes('Vomiting') || symptoms.includes('Diarrhea'))) {
        emergency = true;
        emergencyMsg = "‚ö†Ô∏è YOUNG CHILD with symptoms - Needs immediate medical attention!";
    }
    
    if (emergency) {
        return {
            emergency: true,
            message: emergencyMsg,
            diagnosis: "MEDICAL EMERGENCY",
            solutions: [
                "üöë CALL AMBULANCE IMMEDIATELY - DIAL 108 OR 102",
                "üè• RUSH TO NEAREST HOSPITAL",
                "üõå Keep patient in comfortable position",
                "üí¨ Monitor breathing and consciousness",
                "üö´ Do NOT give food or water if unconscious"
            ],
            medicines: ["üö® EMERGENCY - NO SELF MEDICATION"]
        };
    }
    
    // COMMON COLD / FLU
    if (symptoms.includes('Fever') && symptoms.includes('Cough') && symptoms.includes('Fatigue')) {
        diagnosis.push("Common Cold / Viral Fever");
        solutions.push("üå°Ô∏è Take rest for 2-3 days");
        solutions.push("üíß Drink warm water, soup, and herbal tea");
        solutions.push("üçµ Have ginger tea with honey for sore throat");
        solutions.push("üí® Use steam inhalation for congestion");
        medicines.push("Paracetamol 500mg for fever");
        medicines.push("Cough syrup for dry cough");
    }
    
    // CHEST INFECTION
    else if (symptoms.includes('Wet Cough') && symptoms.includes('Fever')) {
        diagnosis.push("Chest Infection / Bronchitis");
        solutions.push("üí® Do steam inhalation 3-4 times daily");
        solutions.push("üö≠ Avoid smoke and dust");
        solutions.push("üõå Complete bed rest");
        solutions.push("üíß Drink plenty of warm fluids");
        medicines.push("Ambroxol for mucus clearance");
        medicines.push("Consult doctor for antibiotics");
    }
    
    // GASTROENTERITIS
    else if (symptoms.includes('Diarrhea') && symptoms.includes('Vomiting')) {
        diagnosis.push("Acute Gastroenteritis / Food Poisoning");
        solutions.push("üíß Drink ORS solution frequently");
        solutions.push("üçö Eat only bland foods - rice, bananas, apples");
        solutions.push("üö´ Avoid dairy, spicy, and oily food");
        solutions.push("üõå Take complete rest");
        medicines.push("ORS packets - mix in clean water");
        medicines.push("Zinc supplements");
    }
    
    // GASTRITIS
    else if (symptoms.includes('Abdominal Pain') && symptoms.includes('Heartburn')) {
        diagnosis.push("Gastritis / Acidity");
        solutions.push("üçΩÔ∏è Eat small, frequent meals");
        solutions.push("üö´ Avoid spicy, oily, and acidic foods");
        solutions.push("üõå Don't lie down immediately after eating");
        solutions.push("ü•ó Eat bland, easily digestible food");
        medicines.push("Antacids for immediate relief");
    }
    
    // HEADACHE / MIGRAINE
    else if (symptoms.includes('Headache')) {
        diagnosis.push("Tension Headache");
        solutions.push("üò¥ Rest in a dark, quiet room");
        solutions.push("üßä Apply cold compress to forehead");
        solutions.push("üíÜ Massage neck and shoulders gently");
        solutions.push("üö´ Avoid bright lights and loud noise");
        medicines.push("Paracetamol or Ibuprofen");
    }
    
    // BODY PAIN
    else if (symptoms.includes('Muscle Pain') || symptoms.includes('Joint Pain')) {
        diagnosis.push("Body Ache / Myalgia");
        solutions.push("üî• Apply warm compress to painful areas");
        solutions.push("üßò Gentle stretching exercises");
        solutions.push("üíÜ Light massage");
        solutions.push("üõå Take adequate rest");
        medicines.push("Ibuprofen for pain relief");
        medicines.push("Topical pain relief gel");
    }
    
    // UTI
    else if (symptoms.includes('Painful Urination')) {
        diagnosis.push("Urinary Tract Infection (UTI)");
        solutions.push("üö∞ Drink plenty of water (8-10 glasses)");
        solutions.push("üßÉ Drink cranberry juice");
        solutions.push("üöΩ Maintain proper hygiene");
        solutions.push("üö´ Avoid holding urine for long");
        medicines.push("Consult doctor for antibiotics");
    }
    
    // ALLERGY
    else if (symptoms.includes('Rash') || symptoms.includes('Itching')) {
        diagnosis.push("Allergic Reaction");
        solutions.push("üß¥ Apply calamine lotion");
        solutions.push("üö´ Avoid scratching");
        solutions.push("üõÅ Use mild, fragrance-free soap");
        solutions.push("ü•ó Avoid known allergens");
        medicines.push("Antihistamine (Cetirizine)");
    }
    
    // CONSTIPATION
    else if (symptoms.includes('Constipation')) {
        diagnosis.push("Constipation");
        solutions.push("ü•ó Eat high-fiber foods - fruits, vegetables");
        solutions.push("üíß Drink 8-10 glasses of water daily");
        solutions.push("üö∂ Walk for 30 minutes daily");
        solutions.push("üçå Eat bananas and papaya");
        medicines.push("Fiber supplements (Isabgol)");
    }
    
    // If symptoms exist but no specific match
    else if (symptoms.length > 0) {
        diagnosis.push("Multiple Symptoms - General Evaluation Needed");
        solutions.push("ü©∫ Consult Primary Health Center for examination");
        solutions.push("üìù Keep a diary of your symptoms");
        solutions.push("üíß Stay hydrated and get adequate rest");
        solutions.push("ü•ó Eat light, nutritious food");
    }
    
    // No symptoms
    else {
        diagnosis.push("No Symptoms Reported");
        solutions.push("ü•ó Eat a balanced diet with fruits and vegetables");
        solutions.push("üíß Drink 8-10 glasses of water daily");
        solutions.push("üö∂ Exercise for 30 minutes daily");
        solutions.push("üò¥ Get 7-8 hours of sleep");
        solutions.push("ü©∫ Regular health check-ups every 6 months");
        medicines.push("No medicines needed - stay healthy!");
    }
    
    return {
        emergency: false,
        diagnosis: diagnosis.join(", "),
        solutions: solutions,
        medicines: medicines.length ? medicines : ["Consult doctor for specific medication"]
    };
}

// Main analysis function - FIXED
function analyzeHealth() {
    const name = document.getElementById("patientName").value.trim();
    const age = document.getElementById("patientAge").value;
    const temp = parseFloat(document.getElementById("temperature").value) || 36.5;
    const bp = document.getElementById("bp").value || "";
    
    if (!name || !age) {
        alert("‚ö†Ô∏è Please fill Patient Name and Age first");
        return;
    }
    
    // Show loader
    document.getElementById('loader').style.display = 'block';
    document.getElementById('results').style.display = 'none';
    document.getElementById('emergencyAlert').style.display = 'none';
    
    setTimeout(() => {
        document.getElementById('loader').style.display = 'none';
        
        const symptoms = getSelectedSymptoms();
        const analysis = getAIDiagnosis(symptoms, parseInt(age), temp, bp);
        
        let result;
        
        if (analysis.emergency) {
            result = {
                status: "emergency",
                statusText: "üö® EMERGENCY",
                diagnosis: analysis.diagnosis,
                description: analysis.message,
                confidence: 98,
                solutions: analysis.solutions,
                medicines: analysis.medicines,
                symptoms: symptoms.length ? symptoms.join(", ") : "No symptoms",
                followUp: "URGENT: Immediate emergency care required"
            };
        } else if (symptoms.length > 0) {
            result = {
                status: "followup",
                statusText: "‚ö†Ô∏è Needs Medical Attention",
                diagnosis: analysis.diagnosis,
                description: "Based on your symptoms, AI has provided the following recommendations.",
                confidence: 85,
                solutions: analysis.solutions,
                medicines: analysis.medicines,
                symptoms: symptoms.join(", "),
                followUp: "Consult a doctor if symptoms persist beyond 3 days."
            };
        } else {
            result = {
                status: "healthy",
                statusText: "‚úÖ Healthy",
                diagnosis: "No Health Issues Detected",
                description: "You haven't reported any symptoms. Here are general health tips.",
                confidence: 98,
                solutions: analysis.solutions,
                medicines: analysis.medicines,
                symptoms: "No symptoms reported",
                followUp: "No follow-up needed. Stay healthy!"
            };
        }
        
        displayResults(result);
        saveScreening(name, age, result);
    }, 1500);
}

// Display results - FIXED
function displayResults(result) {
    document.getElementById('results').style.display = 'block';
    
    // Set status
    if (result.status === "healthy") {
        document.getElementById('statusText').innerHTML = "<span class='status-healthy'>" + result.statusText + "</span>";
    } else if (result.status === "emergency") {
        document.getElementById('statusText').innerHTML = "<span class='status-emergency'>" + result.statusText + "</span>";
    } else {
        document.getElementById('statusText').innerHTML = "<span class='status-followup'>" + result.statusText + "</span>";
    }
    
    document.getElementById('description').innerText = result.description;
    
    // Set confidence
    document.getElementById('confidenceBar').style.width = result.confidence + "%";
    document.getElementById('confidenceText').innerText = result.confidence + "%";
    
    // Set symptoms
    let symptomsHtml = "";
    if (result.symptoms && result.symptoms !== "No symptoms reported") {
        let symptomArray = result.symptoms.split(", ");
        symptomArray.forEach(s => {
            symptomsHtml += `<span class="symptom-tag">${s}</span> `;
        });
    } else {
        symptomsHtml = "No symptoms selected";
    }
    document.getElementById('symptomList').innerHTML = symptomsHtml;
    
    // Set diagnosis
    let diagnosisHtml = `<div class="possible-condition">
        <span class="condition-name">${result.diagnosis}</span>
        <p style="margin-top:8px">${result.description}</p>
    </div>`;
    document.getElementById('diagnosisContent').innerHTML = diagnosisHtml;
    
    // Set solutions
    let solutionsHtml = "";
    result.solutions.forEach(s => {
        solutionsHtml += `<div class="recommendation-item">${s}</div>`;
    });
    document.getElementById('solutionsList').innerHTML = solutionsHtml;
    
    // Set medicines
    let medicinesHtml = "";
    result.medicines.forEach(m => {
        medicinesHtml += `<div class="medicine-item">üíä ${m}</div>`;
    });
    document.getElementById('medicinesList').innerHTML = medicinesHtml;
    
    document.getElementById('followUp').innerText = result.followUp;
    
    // Handle emergency alert
    if (result.status === "emergency") {
        document.getElementById('emergencyAlert').style.display = 'block';
        document.getElementById('emergencyMessage').innerText = result.description;
    } else {
        document.getElementById('emergencyAlert').style.display = 'none';
    }
}

// Save screening - FIXED
function saveScreening(name, age, result) {
    const record = {
        time: new Date().toLocaleString(),
        name: name,
        age: age,
        diagnosis: result.diagnosis,
        status: result.statusText
    };
    
    screenings.unshift(record);
    if (screenings.length > 20) screenings.pop();
    localStorage.setItem("screenings", JSON.stringify(screenings));
    renderTable();
}

// Render table - FIXED
function renderTable() {
    const tbody = document.getElementById("tableBody");
    if (screenings.length === 0) {
        tbody.innerHTML = "<tr><td colspan='5' style='text-align:center'>No records found</td></tr>";
        return;
    }
    tbody.innerHTML = screenings.map(s => `
        <tr>
            <td>${s.time}</td>
            <td>${s.name}</td>
            <td>${s.age}</td>
            <td>${s.diagnosis}</td>
            <td>${s.status}</td>
        </tr>
    `).join("");
}

// Filter screenings - FIXED
function filterScreenings(type) {
    // Update active button
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    let filtered = screenings;
    if (type === 'healthy') {
        filtered = screenings.filter(s => s.status.includes('‚úÖ'));
    } else if (type === 'followup') {
        filtered = screenings.filter(s => s.status.includes('‚ö†Ô∏è'));
    } else if (type === 'emergency') {
        filtered = screenings.filter(s => s.status.includes('üö®'));
    }
    
    const tbody = document.getElementById("tableBody");
    if (filtered.length === 0) {
        tbody.innerHTML = "<tr><td colspan='5' style='text-align:center'>No records found</td></tr>";
        return;
    }
    tbody.innerHTML = filtered.map(s => `
        <tr>
            <td>${s.time}</td>
            <td>${s.name}</td>
            <td>${s.age}</td>
            <td>${s.diagnosis}</td>
            <td>${s.status}</td>
        </tr>
    `).join("");
}

console.log("RuralCare AI loaded successfully - All functions working!");
</script>

</body>
</html>
